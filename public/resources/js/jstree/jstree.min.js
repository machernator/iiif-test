!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}((function($,e){"use strict";
/*!
 * jsTree 3.3.15
 * http://jstree.com/
 *
 * Copyright (c) 2014 Ivan Bozhanov (http://vakata.com)
 *
 * Licensed same as jquery - under the terms of the MIT License
 *   http://www.opensource.org/licenses/mit-license.php
 */
/*!
 * if using jslint please allow for the jQuery global and use following options:
 * jslint: loopfunc: true, browser: true, ass: true, bitwise: true, continue: true, nomen: true, plusplus: true, regexp: true, unparam: true, todo: true, white: true
 */if(!$.jstree){var t=0,i=!1,r=!1,s=!1,a=[],n=$("script:last").attr("src"),o=window.document,d=window.setImmediate,c=window.Promise;!d&&c&&(d=function(e,t){c.resolve(t).then(e)}),$.jstree={version:"3.3.15",defaults:{plugins:[]},plugins:{},path:n&&-1!==n.indexOf("/")?n.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"},$.jstree.create=function(e,i){var r=new $.jstree.core(++t),s=i;return i=$.extend(!0,{},$.jstree.defaults,i),s&&s.plugins&&(i.plugins=s.plugins),$.each(i.plugins,(function(e,t){"core"!==e&&(r=r.plugin(t,i[t]))})),$(e).data("jstree",r),r.init(e,i),r},$.jstree.destroy=function(){$(".jstree:jstree").jstree("destroy"),$(o).off(".jstree")},$.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1,ellipsis:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},$.jstree.reference=function(e){var t=null,i=null;if(!e||!e.id||e.tagName&&e.nodeType||(e=e.id),!i||!i.length)try{i=$(e)}catch(e){}if(!i||!i.length)try{i=$("#"+e.replace($.jstree.idregex,"\\$&"))}catch(e){}return i&&i.length&&(i=i.closest(".jstree")).length&&(i=i.data("jstree"))?t=i:$(".jstree").each((function(){var i=$(this).data("jstree");if(i&&i._model.data[e])return t=i,!1})),t},$.fn.jstree=function(t){var i="string"==typeof t,r=Array.prototype.slice.call(arguments,1),s=null;return!(!0===t&&!this.length)&&(this.each((function(){var a=$.jstree.reference(this),n=i&&a?a[t]:null;if(s=i&&n?n.apply(a,r):null,a||i||t!==e&&!$.isPlainObject(t)||$.jstree.create(this,t),(a&&!i||!0===t)&&(s=a||!1),null!==s&&s!==e)return!1})),null!==s&&s!==e?s:this)},$.expr.pseudos.jstree=$.expr.createPseudo((function(t){return function(t){return $(t).hasClass("jstree")&&$(t).data("jstree")!==e}})),$.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:$.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,ellipsis:!1,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0,loaded_state:!1,restore_focus:!0,compute_elements_positions:!1,keyboard:{"ctrl-space":function(e){e.type="click",$(e.currentTarget).trigger(e)},enter:function(e){e.type="click",$(e.currentTarget).trigger(e)},left:function(e){if(e.preventDefault(),this.is_open(e.currentTarget))this.close_node(e.currentTarget);else{var t=this.get_parent(e.currentTarget);t&&t.id!==$.jstree.root&&this.get_node(t,!0).children(".jstree-anchor").trigger("focus")}},up:function(e){e.preventDefault();var t=this.get_prev_dom(e.currentTarget);t&&t.length&&t.children(".jstree-anchor").trigger("focus")},right:function(e){if(e.preventDefault(),this.is_closed(e.currentTarget))this.open_node(e.currentTarget,(function(e){this.get_node(e,!0).children(".jstree-anchor").trigger("focus")}));else if(this.is_open(e.currentTarget)){var t=this.get_node(e.currentTarget,!0).children(".jstree-children")[0];t&&$(this._firstChild(t)).children(".jstree-anchor").trigger("focus")}},down:function(e){e.preventDefault();var t=this.get_next_dom(e.currentTarget);t&&t.length&&t.children(".jstree-anchor").trigger("focus")},"*":function(e){this.open_all()},home:function(e){e.preventDefault();var t=this._firstChild(this.get_container_ul()[0]);t&&$(t).children(".jstree-anchor").filter(":visible").trigger("focus")},end:function(e){e.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().trigger("focus")},f2:function(e){e.preventDefault(),this.edit(e.currentTarget)}}},$.jstree.core.prototype={plugin:function(e,t){var i=$.jstree.plugins[e];return i?(this._data[e]={},i.prototype=this,new i(t,this)):this},init:function(e,t){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[$.jstree.root]={id:$.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=$(e).addClass("jstree jstree-"+this._id),this.settings=t,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter((function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))})).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='none'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' role='treeitem' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().outerHeight()||24,this._data.core.node=this._create_prototype_node(),this.trigger("loading"),this.load_node($.jstree.root)},destroy:function(e){if(this.trigger("destroy"),this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(e){}e||this.element.empty(),this.teardown()},_create_prototype_node:function(){var e,t,i=o.createElement("LI");return i.setAttribute("role","none"),(e=o.createElement("I")).className="jstree-icon jstree-ocl",e.setAttribute("role","presentation"),i.appendChild(e),(e=o.createElement("A")).className="jstree-anchor",e.setAttribute("href","#"),e.setAttribute("tabindex","-1"),e.setAttribute("role","treeitem"),(t=o.createElement("I")).className="jstree-icon jstree-themeicon",t.setAttribute("role","presentation"),e.appendChild(t),i.appendChild(e),e=t=null,i},_kbevent_to_func:function(e){var t={8:"Backspace",9:"Tab",13:"Enter",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"Print",45:"Insert",46:"Delete",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9","-13":"NumpadEnter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Numlock",145:"Scrolllock",16:"Shift",17:"Ctrl",18:"Alt",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",111:"/",106:"*",173:"-"},i=[];if(e.ctrlKey&&i.push("ctrl"),e.altKey&&i.push("alt"),e.shiftKey&&i.push("shift"),i.push(t[e.which]?t[e.which].toLowerCase():e.which),"shift-shift"===(i=i.sort().join("-").toLowerCase())||"ctrl-ctrl"===i||"alt-alt"===i)return null;var r,s,a=this.settings.core.keyboard;for(r in a)if(a.hasOwnProperty(r)&&("-"!==(s=r)&&"+"!==s&&(s=(s=s.replace("--","-MINUS").replace("+-","-MINUS").replace("++","-PLUS").replace("-+","-PLUS")).split(/-|\+/).sort().join("-").replace("MINUS","-").replace("PLUS","+").toLowerCase()),s===i))return a[r];return null},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",(function(){return this.className.replace(/jstree[^ ]*|$/gi,"")})),this.element=null},bind:function(){var e="",t=null,i=0;this.element.on("dblclick.jstree",(function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;if(o.selection&&o.selection.empty)o.selection.empty();else if(window.getSelection){var t=window.getSelection();try{t.removeAllRanges(),t.collapse()}catch(e){}}})).on("mousedown.jstree",function(e){e.target===this.element[0]&&(e.preventDefault(),i=+new Date)}.bind(this)).on("mousedown.jstree",".jstree-ocl",(function(e){e.preventDefault()})).on("click.jstree",".jstree-ocl",function(e){this.toggle_node(e.target)}.bind(this)).on("dblclick.jstree",".jstree-anchor",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;this.settings.core.dblclick_toggle&&this.toggle_node(e.target)}.bind(this)).on("click.jstree",".jstree-anchor",function(e){e.preventDefault(),e.currentTarget!==o.activeElement&&$(e.currentTarget).trigger("focus"),this.activate_node(e.currentTarget,e)}.bind(this)).on("keydown.jstree",".jstree-anchor",function(e){if(e.target.tagName&&"input"===e.target.tagName.toLowerCase())return!0;this._data.core.rtl&&(37===e.which?e.which=39:39===e.which&&(e.which=37));var t=this._kbevent_to_func(e);if(t){var i=t.call(this,e);if(!1===i||!0===i)return i}}.bind(this)).on("load_node.jstree",function(e,t){t.status&&(t.node.id!==$.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var e,t,i=[];for(e=0,t=this._data.core.selected.length;e<t;e++)i=i.concat(this._model.data[this._data.core.selected[e]].parents);for(e=0,t=(i=$.vakata.array_unique(i)).length;e<t;e++)this.open_node(i[e],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}}.bind(this),0))}.bind(this)).on("keypress.jstree",function(i){if(i.target.tagName&&"input"===i.target.tagName.toLowerCase())return!0;t&&clearTimeout(t),t=setTimeout((function(){e=""}),500);var r=String.fromCharCode(i.which).toLowerCase(),s=this.element.find(".jstree-anchor").filter(":visible"),a=s.index(o.activeElement)||0,n=!1;if((e+=r).length>1){if(s.slice(a).each(function(t,i){if(0===$(i).text().toLowerCase().indexOf(e))return $(i).trigger("focus"),n=!0,!1}.bind(this)),n)return;if(s.slice(0,a).each(function(t,i){if(0===$(i).text().toLowerCase().indexOf(e))return $(i).trigger("focus"),n=!0,!1}.bind(this)),n)return}if(new RegExp("^"+r.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(e)){if(s.slice(a+1).each(function(e,t){if($(t).text().toLowerCase().charAt(0)===r)return $(t).trigger("focus"),n=!0,!1}.bind(this)),n)return;if(s.slice(0,a+1).each(function(e,t){if($(t).text().toLowerCase().charAt(0)===r)return $(t).trigger("focus"),n=!0,!1}.bind(this)),n)return}}.bind(this)).on("init.jstree",function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this._data.core.themes.ellipsis=e.ellipsis,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)}.bind(this)).on("loading.jstree",function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"](),this[this._data.core.themes.ellipsis?"show_ellipsis":"hide_ellipsis"]()}.bind(this)).on("blur.jstree",".jstree-anchor",function(e){this._data.core.focused=null,$(e.currentTarget).filter(".jstree-hovered").trigger("mouseleave"),this.element.attr("tabindex","0"),$(e.currentTarget).attr("tabindex","-1")}.bind(this)).on("focus.jstree",".jstree-anchor",function(e){var t=this.get_node(e.currentTarget);t&&(t.id||0===t.id)&&(this._data.core.focused=t.id),this.element.find(".jstree-hovered").not(e.currentTarget).trigger("mouseleave"),$(e.currentTarget).trigger("mouseenter"),this.element.attr("tabindex","-1"),$(e.currentTarget).attr("tabindex","0")}.bind(this)).on("focus.jstree",function(){if(+new Date-i>500&&!this._data.core.focused&&this.settings.core.restore_focus){i=0;var e=this.get_node(this.element.attr("aria-activedescendant"),!0);e&&e.find("> .jstree-anchor").trigger("focus")}}.bind(this)).on("mouseenter.jstree",".jstree-anchor",function(e){this.hover_node(e.currentTarget)}.bind(this)).on("mouseleave.jstree",".jstree-anchor",function(e){this.dehover_node(e.currentTarget)}.bind(this))},unbind:function(){this.element.off(".jstree"),$(o).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),t.instance=this,this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(e){var t=this.settings.core.strings;return $.vakata.is_function(t)?t.call(this,e):t&&t[e]?t[e]:e},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(e,t){var i;e&&(e.id||0===e.id)&&(e=e.id),e instanceof $&&e.length&&e[0].id&&(e=e[0].id);try{if(this._model.data[e])e=this._model.data[e];else if("string"==typeof e&&this._model.data[e.replace(/^#/,"")])e=this._model.data[e.replace(/^#/,"")];else if("string"==typeof e&&(i=$("#"+e.replace($.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[i.closest(".jstree-node").attr("id")])e=this._model.data[i.closest(".jstree-node").attr("id")];else if((i=this.element.find(e)).length&&this._model.data[i.closest(".jstree-node").attr("id")])e=this._model.data[i.closest(".jstree-node").attr("id")];else{if(!(i=this.element.find(e)).length||!i.hasClass("jstree"))return!1;e=this._model.data[$.jstree.root]}return t&&(e=e.id===$.jstree.root?this.element:$("#"+e.id.replace($.jstree.idregex,"\\$&"),this.element)),e}catch(e){return!1}},get_path:function(e,t,i){if(!(e=e.parents?e:this.get_node(e))||e.id===$.jstree.root||!e.parents)return!1;var r,s,a=[];for(a.push(i?e.id:e.text),r=0,s=e.parents.length;r<s;r++)a.push(i?e.parents[r]:this.get_text(e.parents[r]));return a=a.reverse().slice(1),t?a.join(t):a},get_next_dom:function(e,t){var i;if((e=this.get_node(e,!0))[0]===this.element[0]){for(i=this._firstChild(this.get_container_ul()[0]);i&&0===i.offsetHeight;)i=this._nextSibling(i);return!!i&&$(i)}if(!e||!e.length)return!1;if(t){i=e[0];do{i=this._nextSibling(i)}while(i&&0===i.offsetHeight);return!!i&&$(i)}if(e.hasClass("jstree-open")){for(i=this._firstChild(e.children(".jstree-children")[0]);i&&0===i.offsetHeight;)i=this._nextSibling(i);if(null!==i)return $(i)}i=e[0];do{i=this._nextSibling(i)}while(i&&0===i.offsetHeight);return null!==i?$(i):e.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(e,t){var i;if((e=this.get_node(e,!0))[0]===this.element[0]){for(i=this.get_container_ul()[0].lastChild;i&&0===i.offsetHeight;)i=this._previousSibling(i);return!!i&&$(i)}if(!e||!e.length)return!1;if(t){i=e[0];do{i=this._previousSibling(i)}while(i&&0===i.offsetHeight);return!!i&&$(i)}i=e[0];do{i=this._previousSibling(i)}while(i&&0===i.offsetHeight);if(null!==i){for(e=$(i);e.hasClass("jstree-open");)e=e.children(".jstree-children").first().children(".jstree-node:visible:last");return e}return!(!(i=e[0].parentNode.parentNode)||!i.className||-1===i.className.indexOf("jstree-node"))&&$(i)},get_parent:function(e){return!(!(e=this.get_node(e))||e.id===$.jstree.root)&&e.parent},get_children_dom:function(e){return(e=this.get_node(e,!0))[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!e||!e.length)&&e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return(e=this.get_node(e))&&(!1===e.state.loaded||e.children.length>0)},is_loaded:function(e){return(e=this.get_node(e))&&e.state.loaded},is_loading:function(e){return(e=this.get_node(e))&&e.state&&e.state.loading},is_open:function(e){return(e=this.get_node(e))&&e.state.opened},is_closed:function(e){return(e=this.get_node(e))&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(e,t){var i,r,s,a,n,o=this.get_node(e,!0);if($.vakata.is_array(e))return this._load_nodes(e.slice(),t),!0;if(!(e=this.get_node(e)))return t&&t.call(this,e,!1),!1;if(e.state.loaded){for(e.state.loaded=!1,s=0,a=e.parents.length;s<a;s++)this._model.data[e.parents[s]].children_d=$.vakata.array_filter(this._model.data[e.parents[s]].children_d,(function(t){return-1===$.inArray(t,e.children_d)}));for(i=0,r=e.children_d.length;i<r;i++)this._model.data[e.children_d[i]].state.selected&&(n=!0),delete this._model.data[e.children_d[i]];n&&(this._data.core.selected=$.vakata.array_filter(this._data.core.selected,(function(t){return-1===$.inArray(t,e.children_d)}))),e.children=[],e.children_d=[],n&&this.trigger("changed",{action:"load_node",node:e,selected:this._data.core.selected})}return e.state.failed=!1,e.state.loading=!0,e.id!==$.jstree.root?o.children(".jstree-anchor").attr("aria-busy",!0):o.attr("aria-busy",!0),o.addClass("jstree-loading"),this._load_node(e,function(i){(e=this._model.data[e.id]).state.loading=!1,e.state.loaded=i,e.state.failed=!e.state.loaded;var r,s=this.get_node(e,!0),a=0,n=this._model.data,o=!1;for(a=0,r=e.children.length;a<r;a++)if(n[e.children[a]]&&!n[e.children[a]].state.hidden){o=!0;break}e.state.loaded&&s&&s.length&&(s.removeClass("jstree-closed jstree-open jstree-leaf"),o?"#"!==e.id&&s.addClass(e.state.opened?"jstree-open":"jstree-closed"):s.addClass("jstree-leaf")),e.id!==$.jstree.root?s.children(".jstree-anchor").attr("aria-busy",!1):s.attr("aria-busy",!1),s.removeClass("jstree-loading"),this.trigger("load_node",{node:e,status:i}),t&&t.call(this,e,i)}.bind(this)),!0},_load_nodes:function(e,t,i,r){var s,a,n=!0,o=function(){this._load_nodes(e,t,!0)},d=this._model.data,c=[];for(s=0,a=e.length;s<a;s++)d[e[s]]&&(!d[e[s]].state.loaded&&!d[e[s]].state.failed||!i&&r)&&(this.is_loading(e[s])||this.load_node(e[s],o),n=!1);if(n){for(s=0,a=e.length;s<a;s++)d[e[s]]&&d[e[s]].state.loaded&&c.push(e[s]);t&&!t.done&&(t.call(this,c),t.done=!0)}},load_all:function(e,t){if(e||(e=$.jstree.root),!(e=this.get_node(e)))return!1;var i,r,s=[],a=this._model.data,n=a[e.id].children_d;for(e.state&&!e.state.loaded&&s.push(e.id),i=0,r=n.length;i<r;i++)a[n[i]]&&a[n[i]].state&&!a[n[i]].state.loaded&&s.push(n[i]);s.length?this._load_nodes(s,(function(){this.load_all(e,t)})):(t&&t.call(this,e),this.trigger("load_all",{node:e}))},_load_node:function(e,t){var i,r=this.settings.core.data,s=function(){return 3!==this.nodeType&&8!==this.nodeType};return r?$.vakata.is_function(r)?r.call(this,e,function(i){!1===i?t.call(this,!1):this["string"==typeof i?"_append_html_data":"_append_json_data"](e,"string"==typeof i?$($.parseHTML(i)).filter(s):i,(function(e){t.call(this,e)}))}.bind(this)):"object"==typeof r?r.url?(r=$.extend(!0,{},r),$.vakata.is_function(r.url)&&(r.url=r.url.call(this,e)),$.vakata.is_function(r.data)&&(r.data=r.data.call(this,e)),$.ajax(r).done(function(i,r,a){var n=a.getResponseHeader("Content-Type");return n&&-1!==n.indexOf("json")||"object"==typeof i?this._append_json_data(e,i,(function(e){t.call(this,e)})):n&&-1!==n.indexOf("html")||"string"==typeof i?this._append_html_data(e,$($.parseHTML(i)).filter(s),(function(e){t.call(this,e)})):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:e.id,xhr:a})},this.settings.core.error.call(this,this._data.core.last_error),t.call(this,!1))}.bind(this)).fail(function(i){this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:e.id,xhr:i})},t.call(this,!1),this.settings.core.error.call(this,this._data.core.last_error)}.bind(this))):(i=$.vakata.is_array(r)?$.extend(!0,[],r):$.isPlainObject(r)?$.extend(!0,{},r):r,e.id===$.jstree.root?this._append_json_data(e,i,(function(e){t.call(this,e)})):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:e.id})},this.settings.core.error.call(this,this._data.core.last_error),t.call(this,!1))):"string"==typeof r?e.id===$.jstree.root?this._append_html_data(e,$($.parseHTML(r)).filter(s),(function(e){t.call(this,e)})):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:e.id})},this.settings.core.error.call(this,this._data.core.last_error),t.call(this,!1)):t.call(this,!1):e.id===$.jstree.root?this._append_html_data(e,this._data.core.original_container_html.clone(!0),(function(e){t.call(this,e)})):t.call(this,!1)},_node_changed:function(e){(e=this.get_node(e))&&-1===$.inArray(e.id,this._model.changed)&&this._model.changed.push(e.id)},_append_html_data:function(e,t,i){(e=this.get_node(e)).children=[],e.children_d=[];var r,s,a,n=t.is("ul")?t.children():t,o=e.id,d=[],c=[],l=this._model.data,h=l[o],_=this._data.core.selected.length;for(n.each(function(e,t){(r=this._parse_model_from_html($(t),o,h.parents.concat()))&&(d.push(r),c.push(r),l[r].children_d.length&&(c=c.concat(l[r].children_d)))}.bind(this)),h.children=d,h.children_d=c,s=0,a=h.parents.length;s<a;s++)l[h.parents[s]].children_d=l[h.parents[s]].children_d.concat(c);this.trigger("model",{nodes:c,parent:o}),o!==$.jstree.root?(this._node_changed(o),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==_&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),i.call(this,!0)},_append_json_data:function(e,t,i,r){if(null!==this.element){(e=this.get_node(e)).children=[],e.children_d=[],t.d&&"string"==typeof(t=t.d)&&(t=JSON.parse(t)),$.vakata.is_array(t)||(t=[t]);var s=null,a={df:this._model.default_state,dat:t,par:e.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},n=this,o=function(e,t){e.data&&(e=e.data);var i,r,s,a,o=e.dat,d=e.par,c=[],l=[],h=[],_=e.df,u=e.t_id,g=e.t_cnt,f=e.m,p=f[d],m=e.sel,v=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,a,n,o,d=e.id.toString(),c={id:d,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:r,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in _)_.hasOwnProperty(s)&&(c.state[s]=_[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(c.icon=e.data.jstree.icon),c.icon!==t&&null!==c.icon&&""!==c.icon||(c.icon=!0),e&&e.data&&(c.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(c.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(c.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(c.li_attr[s]=e.li_attr[s]);if(c.li_attr.id||(c.li_attr.id=d),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(c.a_attr[s]=e.a_attr[s]);for(e&&e.children&&!0===e.children&&(c.state.loaded=!1,c.children=[],c.children_d=[]),f[c.id]=c,s=0,a=c.children.length;s<a;s++)n=v(f[c.children[s]],c.id,r),o=f[n],c.children_d.push(n),o.children_d.length&&(c.children_d=c.children_d.concat(o.children_d));return delete e.data,delete e.children,f[c.id].original=e,c.state.selected&&h.push(c.id),c.id},j=function(e,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,a,n,o,d,c=!1;do{c="j"+u+"_"+ ++g}while(f[c]);for(s in d={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},_)_.hasOwnProperty(s)&&(d.state[s]=_[s]);if(e&&(e.id||0===e.id)&&(d.id=e.id.toString()),e&&e.text&&(d.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(d.state[s]=e.data.jstree[s]);if(e&&"object"==typeof e.state)for(s in e.state)e.state.hasOwnProperty(s)&&(d.state[s]=e.state[s]);if(e&&"object"==typeof e.li_attr)for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=e.li_attr[s]);if(d.li_attr.id&&!d.id&&0!==d.id&&(d.id=d.li_attr.id.toString()),d.id||0===d.id||(d.id=c),d.li_attr.id||(d.li_attr.id=d.id),e&&"object"==typeof e.a_attr)for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,a=e.children.length;s<a;s++)n=j(e.children[s],d.id,r),o=f[n],d.children.push(n),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children_d.concat(d.children)}return e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete e.data,delete e.children,d.original=e,f[d.id]=d,d.state.selected&&h.push(d.id),d.id};if(o.length&&o[0].id!==t&&o[0].parent!==t){for(r=0,s=o.length;r<s;r++)o[r].children||(o[r].children=[]),o[r].state||(o[r].state={}),f[o[r].id.toString()]=o[r];for(r=0,s=o.length;r<s;r++)f[o[r].parent.toString()]?(f[o[r].parent.toString()].children.push(o[r].id.toString()),p.children_d.push(o[r].id.toString())):void 0!==n&&(n._data.core.last_error={error:"parse",plugin:"core",id:"core_07",reason:"Node with invalid parent",data:JSON.stringify({id:o[r].id.toString(),parent:o[r].parent.toString()})},n.settings.core.error.call(n,n._data.core.last_error));for(r=0,s=p.children.length;r<s;r++)i=v(f[p.children[r]],d,p.parents.concat()),l.push(i),f[i].children_d.length&&(l=l.concat(f[i].children_d));for(r=0,s=p.parents.length;r<s;r++)f[p.parents[r]].children_d=f[p.parents[r]].children_d.concat(l);a={cnt:g,mod:f,sel:m,par:d,dpc:l,add:h}}else{for(r=0,s=o.length;r<s;r++)(i=j(o[r],d,p.parents.concat()))&&(c.push(i),l.push(i),f[i].children_d.length&&(l=l.concat(f[i].children_d)));for(p.children=c,p.children_d=l,r=0,s=p.parents.length;r<s;r++)f[p.parents[r]].children_d=f[p.parents[r]].children_d.concat(l);a={cnt:g,mod:f,sel:m,par:d,dpc:l,add:h}}if("undefined"!=typeof window&&void 0!==window.document)return a;postMessage(a)},c=function(e,t){if(null!==this.element){this._cnt=e.cnt;var r,s=this._model.data;for(r in s)s.hasOwnProperty(r)&&s[r].state&&s[r].state.loading&&e.mod[r]&&(e.mod[r].state.loading=!0);if(this._model.data=e.mod,t){var a,o=e.add,c=e.sel,l=this._data.core.selected.slice();if(s=this._model.data,c.length!==l.length||$.vakata.array_unique(c.concat(l)).length!==c.length){for(r=0,a=c.length;r<a;r++)-1===$.inArray(c[r],o)&&-1===$.inArray(c[r],l)&&(s[c[r]].state.selected=!1);for(r=0,a=l.length;r<a;r++)-1===$.inArray(l[r],c)&&(s[l[r]].state.selected=!0)}}e.add.length&&(this._data.core.selected=this._data.core.selected.concat(e.add)),this.trigger("model",{nodes:e.dpc,parent:e.par}),e.par!==$.jstree.root?(this._node_changed(e.par),this.redraw()):this.redraw(!0),e.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),!t&&d?d((function(){i.call(n,!0)})):i.call(n,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString()],{type:"text/javascript"}))),!this._data.core.working||r?(this._data.core.working=!0,(s=new window.Worker(this._wrk)).onmessage=function(e){c.call(this,e.data,!0);try{s.terminate(),s=null}catch(e){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}.bind(this),s.onerror=function(e){c.call(this,o(a),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}.bind(this),a.par?s.postMessage(a):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([e,t,i,!0])}catch(e){c.call(this,o(a),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else c.call(this,o(a),!1)}},_parse_model_from_html:function(t,i,r){r=r?[].concat(r):[],i&&r.unshift(i);var s,a,n,o,d,c=this._model.data,l={id:!1,text:!1,icon:!0,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(n in this._model.default_state)this._model.default_state.hasOwnProperty(n)&&(l.state[n]=this._model.default_state[n]);if(o=$.vakata.attributes(t,!0),$.each(o,(function(e,t){if(!(t=$.vakata.trim(t)).length)return!0;l.li_attr[e]=t,"id"===e&&(l.id=t.toString())})),(o=t.children("a").first()).length&&(o=$.vakata.attributes(o,!0),$.each(o,(function(e,t){(t=$.vakata.trim(t)).length&&(l.a_attr[e]=t)}))),(o=t.children("a").first().length?t.children("a").first().clone():t.clone()).children("ins, i, ul").remove(),o=o.html(),o=$("<div></div>").html(o),l.text=this.settings.core.force_text?o.text():o.html(),o=t.data(),l.data=o?$.extend(!0,{},o):null,l.state.opened=t.hasClass("jstree-open"),l.state.selected=t.children("a").hasClass("jstree-clicked"),l.state.disabled=t.children("a").hasClass("jstree-disabled"),l.data&&l.data.jstree)for(n in l.data.jstree)l.data.jstree.hasOwnProperty(n)&&(l.state[n]=l.data.jstree[n]);(o=t.children("a").children(".jstree-themeicon")).length&&(l.icon=!o.hasClass("jstree-themeicon-hidden")&&o.attr("rel")),l.state.icon!==e&&(l.icon=l.state.icon),l.icon!==e&&null!==l.icon&&""!==l.icon||(l.icon=!0),o=t.children("ul").children("li");do{d="j"+this._id+"_"+ ++this._cnt}while(c[d]);return l.id=l.li_attr.id?l.li_attr.id.toString():d,o.length?(o.each(function(e,t){s=this._parse_model_from_html($(t),l.id,r),a=this._model.data[s],l.children.push(s),a.children_d.length&&(l.children_d=l.children_d.concat(a.children_d))}.bind(this)),l.children_d=l.children_d.concat(l.children)):t.hasClass("jstree-closed")&&(l.state.loaded=!1),l.li_attr.class&&(l.li_attr.class=l.li_attr.class.replace("jstree-closed","").replace("jstree-open","")),l.a_attr.class&&(l.a_attr.class=l.a_attr.class.replace("jstree-clicked","").replace("jstree-disabled","")),c[l.id]=l,l.state.selected&&this._data.core.selected.push(l.id),l.id},_parse_model_from_flat_json:function(t,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,a,n,o,d=t.id.toString(),c=this._model.data,l=this._model.default_state,h={id:d,text:t.text||"",icon:t.icon===e||t.icon,parent:i,parents:r,children:t.children||[],children_d:t.children_d||[],data:t.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in l)l.hasOwnProperty(s)&&(h.state[s]=l[s]);if(t&&t.data&&t.data.jstree&&t.data.jstree.icon&&(h.icon=t.data.jstree.icon),h.icon!==e&&null!==h.icon&&""!==h.icon||(h.icon=!0),t&&t.data&&(h.data=t.data,t.data.jstree))for(s in t.data.jstree)t.data.jstree.hasOwnProperty(s)&&(h.state[s]=t.data.jstree[s]);if(t&&"object"==typeof t.state)for(s in t.state)t.state.hasOwnProperty(s)&&(h.state[s]=t.state[s]);if(t&&"object"==typeof t.li_attr)for(s in t.li_attr)t.li_attr.hasOwnProperty(s)&&(h.li_attr[s]=t.li_attr[s]);if(h.li_attr.id||(h.li_attr.id=d),t&&"object"==typeof t.a_attr)for(s in t.a_attr)t.a_attr.hasOwnProperty(s)&&(h.a_attr[s]=t.a_attr[s]);for(t&&t.children&&!0===t.children&&(h.state.loaded=!1,h.children=[],h.children_d=[]),c[h.id]=h,s=0,a=h.children.length;s<a;s++)o=c[n=this._parse_model_from_flat_json(c[h.children[s]],h.id,r)],h.children_d.push(n),o.children_d.length&&(h.children_d=h.children_d.concat(o.children_d));return delete t.data,delete t.children,c[h.id].original=t,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_json:function(t,i,r){r=r?r.concat():[],i&&r.unshift(i);var s,a,n,o,d,c=!1,l=this._model.data,h=this._model.default_state;do{c="j"+this._id+"_"+ ++this._cnt}while(l[c]);for(s in d={id:!1,text:"string"==typeof t?t:"",icon:"object"!=typeof t||t.icon===e||t.icon,parent:i,parents:r,children:[],children_d:[],data:null,state:{},li_attr:{
id:!1},a_attr:{href:"#"},original:!1},h)h.hasOwnProperty(s)&&(d.state[s]=h[s]);if(t&&(t.id||0===t.id)&&(d.id=t.id.toString()),t&&t.text&&(d.text=t.text),t&&t.data&&t.data.jstree&&t.data.jstree.icon&&(d.icon=t.data.jstree.icon),d.icon!==e&&null!==d.icon&&""!==d.icon||(d.icon=!0),t&&t.data&&(d.data=t.data,t.data.jstree))for(s in t.data.jstree)t.data.jstree.hasOwnProperty(s)&&(d.state[s]=t.data.jstree[s]);if(t&&"object"==typeof t.state)for(s in t.state)t.state.hasOwnProperty(s)&&(d.state[s]=t.state[s]);if(t&&"object"==typeof t.li_attr)for(s in t.li_attr)t.li_attr.hasOwnProperty(s)&&(d.li_attr[s]=t.li_attr[s]);if(d.li_attr.id&&!d.id&&0!==d.id&&(d.id=d.li_attr.id.toString()),d.id||0===d.id||(d.id=c),d.li_attr.id||(d.li_attr.id=d.id),t&&"object"==typeof t.a_attr)for(s in t.a_attr)t.a_attr.hasOwnProperty(s)&&(d.a_attr[s]=t.a_attr[s]);if(t&&t.children&&t.children.length){for(s=0,a=t.children.length;s<a;s++)o=l[n=this._parse_model_from_json(t.children[s],d.id,r)],d.children.push(n),o.children_d.length&&(d.children_d=d.children_d.concat(o.children_d));d.children_d=d.children.concat(d.children_d)}return t&&t.children&&!0===t.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),delete t.data,delete t.children,d.original=t,l[d.id]=d,d.state.selected&&this._data.core.selected.push(d.id),d.id},_redraw:function(){var e,t,i,r=this._model.force_full_redraw?this._model.data[$.jstree.root].children.concat([]):this._model.changed.concat([]),s=o.createElement("UL"),a=this._data.core.focused;for(t=0,i=r.length;t<i;t++)(e=this.redraw_node(r[t],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&s.appendChild(e);this._model.force_full_redraw&&(s.className=this.get_container_ul()[0].className,s.setAttribute("role","presentation"),this.element.empty().append(s)),null!==a&&this.settings.core.restore_focus&&((e=this.get_node(a,!0))&&e.length&&e.children(".jstree-anchor")[0]!==o.activeElement?e.children(".jstree-anchor").trigger("focus"):this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:r})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(e){var t=this.get_node(e),i=!1,r=!1,s=!1,a=o;if(!t)return!1;if(t.id===$.jstree.root)return this.redraw(!0);if(!(e=this.get_node(e,!0))||!e.length)return!1;if(e.children(".jstree-children").remove(),e=e[0],t.children.length&&t.state.loaded){for((s=a.createElement("UL")).setAttribute("role","group"),s.className="jstree-children",i=0,r=t.children.length;i<r;i++)s.appendChild(this.redraw_node(t.children[i],!0,!0));e.appendChild(s)}},redraw_node:function(e,t,i,r){var s=this.get_node(e),a=!1,n=!1,d=!1,c=!1,l=!1,h=!1,_="",u=o,g=this._model.data,f=!1,p=null,m=0,v=0,j=!1,k=!1;if(!s)return!1;if(s.id===$.jstree.root)return this.redraw(!0);if(t=t||0===s.children.length,e=o.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(s.id[0])?"\\3"+s.id[0]+" "+s.id.substr(1).replace($.jstree.idregex,"\\$&"):s.id.replace($.jstree.idregex,"\\$&"))):o.getElementById(s.id))e=$(e),i||((a=e.parent().parent()[0])===this.element[0]&&(a=null),n=e.index()),t||!s.children.length||e.children(".jstree-children").length||(t=!0),t||(d=e.children(".jstree-children")[0]),f=e.children(".jstree-anchor")[0]===o.activeElement,e.remove();else if(t=!0,!i){if(!(null===(a=s.parent!==$.jstree.root?$("#"+s.parent.replace($.jstree.idregex,"\\$&"),this.element)[0]:null)||a&&g[s.parent].state.opened))return!1;n=$.inArray(s.id,null===a?g[$.jstree.root].children:g[s.parent].children)}for(c in e=this._data.core.node.cloneNode(!0),_="jstree-node ",s.li_attr)if(s.li_attr.hasOwnProperty(c)){if("id"===c)continue;"class"!==c?e.setAttribute(c,s.li_attr[c]):_+=s.li_attr[c]}for(s.a_attr.id||(s.a_attr.id=s.id+"_anchor"),e.childNodes[1].setAttribute("aria-selected",!!s.state.selected),e.childNodes[1].setAttribute("aria-level",s.parents.length),this.settings.core.compute_elements_positions&&(e.childNodes[1].setAttribute("aria-setsize",g[s.parent].children.length),e.childNodes[1].setAttribute("aria-posinset",g[s.parent].children.indexOf(s.id)+1)),s.state.disabled&&e.childNodes[1].setAttribute("aria-disabled",!0),c=0,l=s.children.length;c<l;c++)if(!g[s.children[c]].state.hidden){j=!0;break}if(null!==s.parent&&g[s.parent]&&!s.state.hidden&&(c=$.inArray(s.id,g[s.parent].children),k=s.id,-1!==c))for(c++,l=g[s.parent].children.length;c<l&&(g[g[s.parent].children[c]].state.hidden||(k=g[s.parent].children[c]),k===s.id);c++);for(l in s.state.hidden&&(_+=" jstree-hidden"),s.state.loading&&(_+=" jstree-loading"),s.state.loaded&&!j?_+=" jstree-leaf":(_+=s.state.opened&&s.state.loaded?" jstree-open":" jstree-closed",e.childNodes[1].setAttribute("aria-expanded",s.state.opened&&s.state.loaded)),k===s.id&&(_+=" jstree-last"),e.id=s.id,e.className=_,_=(s.state.selected?" jstree-clicked":"")+(s.state.disabled?" jstree-disabled":""),s.a_attr)if(s.a_attr.hasOwnProperty(l)){if("href"===l&&"#"===s.a_attr[l])continue;"class"!==l?e.childNodes[1].setAttribute(l,s.a_attr[l]):_+=" "+s.a_attr[l]}if(_.length&&(e.childNodes[1].className="jstree-anchor "+_),(s.icon&&!0!==s.icon||!1===s.icon)&&(!1===s.icon?e.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===s.icon.indexOf("/")&&-1===s.icon.indexOf(".")?e.childNodes[1].childNodes[0].className+=" "+s.icon+" jstree-themeicon-custom":(e.childNodes[1].childNodes[0].style.backgroundImage='url("'+s.icon+'")',e.childNodes[1].childNodes[0].style.backgroundPosition="center center",e.childNodes[1].childNodes[0].style.backgroundSize="auto",e.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?e.childNodes[1].appendChild(u.createTextNode(s.text)):e.childNodes[1].innerHTML+=s.text,t&&s.children.length&&(s.state.opened||r)&&s.state.loaded){for((h=u.createElement("UL")).setAttribute("role","group"),h.className="jstree-children",c=0,l=s.children.length;c<l;c++)h.appendChild(this.redraw_node(s.children[c],t,!0));e.appendChild(h)}if(d&&e.appendChild(d),!i){for(a||(a=this.element[0]),c=0,l=a.childNodes.length;c<l;c++)if(a.childNodes[c]&&a.childNodes[c].className&&-1!==a.childNodes[c].className.indexOf("jstree-children")){p=a.childNodes[c];break}p||((p=u.createElement("UL")).setAttribute("role","group"),p.className="jstree-children",a.appendChild(p)),n<(a=p).childNodes.length?a.insertBefore(e,a.childNodes[n]):a.appendChild(e),f&&(m=this.element[0].scrollTop,v=this.element[0].scrollLeft,e.childNodes[1].focus(),this.element[0].scrollTop=m,this.element[0].scrollLeft=v)}return s.state.opened&&!s.state.loaded&&(s.state.opened=!1,setTimeout(function(){this.open_node(s.id,!1,0)}.bind(this),0)),e},open_node:function(t,i,r){var s,a,n,o;if($.vakata.is_array(t)){for(s=0,a=(t=t.slice()).length;s<a;s++)this.open_node(t[s],i,r);return!0}return!(!(t=this.get_node(t))||t.id===$.jstree.root)&&(r=r===e?this.settings.core.animation:r,this.is_closed(t)?this.is_loaded(t)?(n=this.get_node(t,!0),o=this,n.length&&(r&&n.children(".jstree-children").length&&n.children(".jstree-children").stop(!0,!0),t.children.length&&!this._firstChild(n.children(".jstree-children")[0])&&this.draw_children(t),r?(this.trigger("before_open",{node:t}),n.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").children(".jstree-anchor").attr("aria-expanded",!0).end().children(".jstree-children").stop(!0,!0).slideDown(r,(function(){this.style.display="",o.element&&o.trigger("after_open",{node:t})}))):(this.trigger("before_open",{node:t}),n[0].className=n[0].className.replace("jstree-closed","jstree-open"),n[0].childNodes[1].setAttribute("aria-expanded",!0))),t.state.opened=!0,i&&i.call(this,t,!0),n.length||this.trigger("before_open",{node:t}),this.trigger("open_node",{node:t}),r&&n.length||this.trigger("after_open",{node:t}),!0):this.is_loading(t)?setTimeout(function(){this.open_node(t,i,r)}.bind(this),500):void this.load_node(t,(function(e,t){return t?this.open_node(e,i,r):!!i&&i.call(this,e,!1)})):(i&&i.call(this,t,!1),!1))},_open_to:function(e){if(!(e=this.get_node(e))||e.id===$.jstree.root)return!1;var t,i,r=e.parents;for(t=0,i=r.length;t<i;t+=1)t!==$.jstree.root&&this.open_node(r[t],!1,0);return $("#"+e.id.replace($.jstree.idregex,"\\$&"),this.element)},close_node:function(t,i){var r,s,a,n;if($.vakata.is_array(t)){for(r=0,s=(t=t.slice()).length;r<s;r++)this.close_node(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===$.jstree.root)&&(!this.is_closed(t)&&(i=i===e?this.settings.core.animation:i,a=this,n=this.get_node(t,!0),t.state.opened=!1,this.trigger("close_node",{node:t}),void(n.length?i?n.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").children(".jstree-anchor").attr("aria-expanded",!1).end().children(".jstree-children").stop(!0,!0).slideUp(i,(function(){this.style.display="",n.children(".jstree-children").remove(),a.element&&a.trigger("after_close",{node:t})})):(n[0].className=n[0].className.replace("jstree-open","jstree-closed"),n.children(".jstree-anchor").attr("aria-expanded",!1),n.children(".jstree-children").remove(),this.trigger("after_close",{node:t})):this.trigger("after_close",{node:t}))))},toggle_node:function(e){var t,i;if($.vakata.is_array(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.toggle_node(e[t]);return!0}return this.is_closed(e)?this.open_node(e):this.is_open(e)?this.close_node(e):void 0},open_all:function(e,t,i){if(e||(e=$.jstree.root),!(e=this.get_node(e)))return!1;var r,s,a,n=e.id===$.jstree.root?this.get_container_ul():this.get_node(e,!0);if(!n.length){for(r=0,s=e.children_d.length;r<s;r++)this.is_closed(this._model.data[e.children_d[r]])&&(this._model.data[e.children_d[r]].state.opened=!0);return this.trigger("open_all",{node:e})}i=i||n,a=this,(n=this.is_closed(e)?n.find(".jstree-closed").addBack():n.find(".jstree-closed")).each((function(){a.open_node(this,(function(e,r){r&&this.is_parent(e)&&this.open_all(e,t,i)}),t||0)})),0===i.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(i)})},close_all:function(e,t){if(e||(e=$.jstree.root),!(e=this.get_node(e)))return!1;var i,r,s=e.id===$.jstree.root?this.get_container_ul():this.get_node(e,!0),a=this;for(s.length&&(s=this.is_open(e)?s.find(".jstree-open").addBack():s.find(".jstree-open"),$(s.get().reverse()).each((function(){a.close_node(this,t||0)}))),i=0,r=e.children_d.length;i<r;i++)this._model.data[e.children_d[i]].state.opened=!1;this.trigger("close_all",{node:e})},is_disabled:function(e){return(e=this.get_node(e))&&e.state&&e.state.disabled},enable_node:function(e){var t,i;if($.vakata.is_array(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.enable_node(e[t]);return!0}if(!(e=this.get_node(e))||e.id===$.jstree.root)return!1;e.state.disabled=!1,this.get_node(e,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),this.trigger("enable_node",{node:e})},disable_node:function(e){var t,i;if($.vakata.is_array(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.disable_node(e[t]);return!0}if(!(e=this.get_node(e))||e.id===$.jstree.root)return!1;e.state.disabled=!0,this.get_node(e,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),this.trigger("disable_node",{node:e})},is_hidden:function(e){return!0===(e=this.get_node(e)).state.hidden},hide_node:function(e,t){var i,r;if($.vakata.is_array(e)){for(i=0,r=(e=e.slice()).length;i<r;i++)this.hide_node(e[i],!0);return t||this.redraw(),!0}if(!(e=this.get_node(e))||e.id===$.jstree.root)return!1;e.state.hidden||(e.state.hidden=!0,this._node_changed(e.parent),t||this.redraw(),this.trigger("hide_node",{node:e}))},show_node:function(e,t){var i,r;if($.vakata.is_array(e)){for(i=0,r=(e=e.slice()).length;i<r;i++)this.show_node(e[i],!0);return t||this.redraw(),!0}if(!(e=this.get_node(e))||e.id===$.jstree.root)return!1;e.state.hidden&&(e.state.hidden=!1,this._node_changed(e.parent),t||this.redraw(),this.trigger("show_node",{node:e}))},hide_all:function(e){var t,i=this._model.data,r=[];for(t in i)i.hasOwnProperty(t)&&t!==$.jstree.root&&!i[t].state.hidden&&(i[t].state.hidden=!0,r.push(t));return this._model.force_full_redraw=!0,e||this.redraw(),this.trigger("hide_all",{nodes:r}),r},show_all:function(e){var t,i=this._model.data,r=[];for(t in i)i.hasOwnProperty(t)&&t!==$.jstree.root&&i[t].state.hidden&&(i[t].state.hidden=!1,r.push(t));return this._model.force_full_redraw=!0,e||this.redraw(),this.trigger("show_all",{nodes:r}),r},activate_node:function(t,i){if(this.is_disabled(t))return!1;if(i&&"object"==typeof i||(i={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==e?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&(!i.shiftKey||this._data.core.last_clicked&&this.get_parent(t)&&this.get_parent(t)===this._data.core.last_clicked.parent))if(i.shiftKey){var r,s,a=this.get_node(t).id,n=this._data.core.last_clicked.id,o=this.get_node(this._data.core.last_clicked.parent).children,d=!1;for(r=0,s=o.length;r<s;r+=1)o[r]===a&&(d=!d),o[r]===n&&(d=!d),this.is_disabled(o[r])||!d&&o[r]!==a&&o[r]!==n?i.ctrlKey||this.deselect_node(o[r],!0,i):this.is_hidden(o[r])||this.select_node(o[r],!0,!1,i);this.trigger("changed",{action:"select_node",node:this.get_node(t),selected:this._data.core.selected,event:i})}else this.is_selected(t)?this.deselect_node(t,!1,i):(i.ctrlKey&&(this._data.core.last_clicked=this.get_node(t)),this.select_node(t,!1,!1,i));else!this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&this.is_selected(t)?this.deselect_node(t,!1,i):(this.is_selected(t)&&1===this._data.core.selected.length||(this.deselect_all(!0),this.select_node(t,!1,!1,i)),this._data.core.last_clicked=this.get_node(t));this.trigger("activate_node",{node:this.get_node(t),event:i})},hover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout((function(){i.attr("aria-activedescendant",e[0].id)}),0)},dehover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||!e.children(".jstree-hovered").length)return!1;e.children(".jstree-anchor").removeClass("jstree-hovered"),this.trigger("dehover_node",{node:this.get_node(e)})},select_node:function(e,t,i,r){var s,a,n;if($.vakata.is_array(e)){for(a=0,n=(e=e.slice()).length;a<n;a++)this.select_node(e[a],t,i,r);return!0}if(!(e=this.get_node(e))||e.id===$.jstree.root)return!1;s=this.get_node(e,!0),e.state.selected||(e.state.selected=!0,this._data.core.selected.push(e.id),i||(s=this._open_to(e)),s&&s.length&&s.children(".jstree-anchor").addClass("jstree-clicked").attr("aria-selected",!0),this.trigger("select_node",{node:e,selected:this._data.core.selected,event:r}),t||this.trigger("changed",{action:"select_node",node:e,selected:this._data.core.selected,event:r}))},deselect_node:function(e,t,i){var r,s,a;if($.vakata.is_array(e)){for(r=0,s=(e=e.slice()).length;r<s;r++)this.deselect_node(e[r],t,i);return!0}if(!(e=this.get_node(e))||e.id===$.jstree.root)return!1;a=this.get_node(e,!0),e.state.selected&&(e.state.selected=!1,this._data.core.selected=$.vakata.array_remove_item(this._data.core.selected,e.id),a.length&&a.children(".jstree-anchor").removeClass("jstree-clicked").attr("aria-selected",!1),this.trigger("deselect_node",{node:e,selected:this._data.core.selected,event:i}),t||this.trigger("changed",{action:"deselect_node",node:e,selected:this._data.core.selected,event:i}))},select_all:function(e){var t,i,r=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data[$.jstree.root].children_d.concat(),t=0,i=this._data.core.selected.length;t<i;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),e||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:r})},deselect_all:function(e){var t,i,r=this._data.core.selected.concat([]);for(t=0,i=this._data.core.selected.length;t<i;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:r}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:r})},is_selected:function(e){return!(!(e=this.get_node(e))||e.id===$.jstree.root)&&e.state.selected},get_selected:function(e){return e?$.map(this._data.core.selected,function(e){return this.get_node(e)}.bind(this)):this._data.core.selected.slice()},get_top_selected:function(e){var t,i,r,s,a=this.get_selected(!0),n={};for(t=0,i=a.length;t<i;t++)n[a[t].id]=a[t];for(t=0,i=a.length;t<i;t++)for(r=0,s=a[t].children_d.length;r<s;r++)n[a[t].children_d[r]]&&delete n[a[t].children_d[r]];for(t in a=[],n)n.hasOwnProperty(t)&&a.push(t);return e?$.map(a,function(e){return this.get_node(e)}.bind(this)):a},get_bottom_selected:function(e){var t,i,r=this.get_selected(!0),s=[];for(t=0,i=r.length;t<i;t++)r[t].children.length||s.push(r[t].id);return e?$.map(s,function(e){return this.get_node(e)}.bind(this)):s},get_state:function(){var e,t={core:{open:[],loaded:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},
/*!
					'themes' : {
						'name' : this.get_theme(),
						'icons' : this._data.core.themes.icons,
						'dots' : this._data.core.themes.dots
					},
					*/
selected:[]}};for(e in this._model.data)this._model.data.hasOwnProperty(e)&&e!==$.jstree.root&&(this._model.data[e].state.loaded&&this.settings.core.loaded_state&&t.core.loaded.push(e),this._model.data[e].state.opened&&t.core.open.push(e),this._model.data[e].state.selected&&t.core.selected.push(e));return t},set_state:function(t,i){if(t){if(t.core&&t.core.selected&&t.core.initial_selection===e&&(t.core.initial_selection=this._data.core.selected.concat([]).sort().join(",")),t.core){var r,s;if(t.core.loaded)return this.settings.core.loaded_state&&$.vakata.is_array(t.core.loaded)&&t.core.loaded.length?this._load_nodes(t.core.loaded,(function(e){delete t.core.loaded,this.set_state(t,i)})):(delete t.core.loaded,this.set_state(t,i)),!1;if(t.core.open)return $.vakata.is_array(t.core.open)&&t.core.open.length?this._load_nodes(t.core.open,(function(e){this.open_node(e,!1,0),delete t.core.open,this.set_state(t,i)})):(delete t.core.open,this.set_state(t,i)),!1;if(t.core.scroll)return t.core.scroll&&t.core.scroll.left!==e&&this.element.scrollLeft(t.core.scroll.left),t.core.scroll&&t.core.scroll.top!==e&&this.element.scrollTop(t.core.scroll.top),delete t.core.scroll,this.set_state(t,i),!1;if(t.core.selected)return r=this,t.core.initial_selection!==e&&t.core.initial_selection!==this._data.core.selected.concat([]).sort().join(",")||(this.deselect_all(),$.each(t.core.selected,(function(e,t){r.select_node(t,!1,!0)}))),delete t.core.initial_selection,delete t.core.selected,this.set_state(t,i),!1;for(s in t)t.hasOwnProperty(s)&&"core"!==s&&-1===$.inArray(s,this.settings.plugins)&&delete t[s];if($.isEmptyObject(t.core))return delete t.core,this.set_state(t,i),!1}return!$.isEmptyObject(t)||(t=null,i&&i.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(e,t){this._data.core.state=!0===t?{}:this.get_state(),t&&$.vakata.is_function(t)&&(this._data.core.state=t.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[$.jstree.root]={id:$.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var i=this.get_container_ul()[0].className;e||(this.element.html("<ul class='"+i+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='none' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' role='treeitem' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node($.jstree.root,(function(e,t){t&&(this.get_container_ul()[0].className=i,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state($.extend(!0,{},this._data.core.state),(function(){this.trigger("refresh")}))),this._data.core.state=null}))},refresh_node:function(e){if(!(e=this.get_node(e))||e.id===$.jstree.root)return!1;var t=[],i=[],r=this._data.core.selected.concat([]);i.push(e.id),!0===e.state.opened&&t.push(e.id),this.get_node(e,!0).find(".jstree-open").each((function(){i.push(this.id),t.push(this.id)})),this._load_nodes(i,function(i){this.open_node(t,!1,0),this.select_node(r),this.trigger("refresh_node",{node:e,nodes:i})}.bind(this),!1,!0)},set_id:function(e,t){if(!(e=this.get_node(e))||e.id===$.jstree.root)return!1;var i,r,s=this._model.data,a=e.id;for(t=t.toString(),s[e.parent].children[$.inArray(e.id,s[e.parent].children)]=t,i=0,r=e.parents.length;i<r;i++)s[e.parents[i]].children_d[$.inArray(e.id,s[e.parents[i]].children_d)]=t;for(i=0,r=e.children.length;i<r;i++)s[e.children[i]].parent=t;for(i=0,r=e.children_d.length;i<r;i++)s[e.children_d[i]].parents[$.inArray(e.id,s[e.children_d[i]].parents)]=t;return-1!==(i=$.inArray(e.id,this._data.core.selected))&&(this._data.core.selected[i]=t),(i=this.get_node(e.id,!0))&&(i.attr("id",t),this.element.attr("aria-activedescendant")===e.id&&this.element.attr("aria-activedescendant",t)),delete s[e.id],e.id=t,e.li_attr.id=t,s[t]=e,this.trigger("set_id",{node:e,new:e.id,old:a}),!0},get_text:function(e){return!(!(e=this.get_node(e))||e.id===$.jstree.root)&&e.text},set_text:function(e,t){var i,r;if($.vakata.is_array(e)){for(i=0,r=(e=e.slice()).length;i<r;i++)this.set_text(e[i],t);return!0}return!(!(e=this.get_node(e))||e.id===$.jstree.root)&&(e.text=t,this.get_node(e,!0).length&&this.redraw_node(e.id),this.trigger("set_text",{obj:e,text:t}),!0)},get_json:function(e,t,i){if(!(e=this.get_node(e||$.jstree.root)))return!1;t&&t.flat&&!i&&(i=[]);var r,s,a={id:e.id,text:e.text,icon:this.get_icon(e),li_attr:$.extend(!0,{},e.li_attr),a_attr:$.extend(!0,{},e.a_attr),state:{},data:(!t||!t.no_data)&&$.extend(!0,$.vakata.is_array(e.data)?[]:{},e.data)};if(t&&t.flat?a.parent=e.parent:a.children=[],t&&t.no_state)delete a.state;else for(r in e.state)e.state.hasOwnProperty(r)&&(a.state[r]=e.state[r]);if(t&&t.no_li_attr&&delete a.li_attr,t&&t.no_a_attr&&delete a.a_attr,t&&t.no_id&&(delete a.id,a.li_attr&&a.li_attr.id&&delete a.li_attr.id,a.a_attr&&a.a_attr.id&&delete a.a_attr.id),t&&t.flat&&e.id!==$.jstree.root&&i.push(a),!t||!t.no_children)for(r=0,s=e.children.length;r<s;r++)t&&t.flat?this.get_json(e.children[r],t,i):a.children.push(this.get_json(e.children[r],t));return t&&t.flat?i:e.id===$.jstree.root?a.children:a},create_node:function(t,i,r,s,a){if(null===t&&(t=$.jstree.root),!(t=this.get_node(t)))return!1;if(!(r=r===e?"last":r).toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(t))return this.load_node(t,(function(){this.create_node(t,i,r,s,!0)}));var n,o,d,c;switch(i||(i={text:this.get_string("New node")}),(i="string"==typeof i?{text:i}:$.extend(!0,{},i)).text===e&&(i.text=this.get_string("New node")),t.id===$.jstree.root&&("before"===r&&(r="first"),"after"===r&&(r="last")),r){case"before":n=this.get_node(t.parent),r=$.inArray(t.id,n.children),t=n;break;case"after":n=this.get_node(t.parent),r=$.inArray(t.id,n.children)+1,t=n;break;case"inside":case"first":r=0;break;case"last":r=t.children.length;break;default:r||(r=0)}if(r>t.children.length&&(r=t.children.length),i.id===e&&(i.id=!0),!this.check("create_node",i,t,r))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===i.id&&delete i.id,!(i=this._parse_model_from_json(i,t.id,t.parents.concat())))return!1;for(n=this.get_node(i),(o=[]).push(i),o=o.concat(n.children_d),this.trigger("model",{nodes:o,parent:t.id}),t.children_d=t.children_d.concat(o),d=0,c=t.parents.length;d<c;d++)this._model.data[t.parents[d]].children_d=this._model.data[t.parents[d]].children_d.concat(o);for(i=n,n=[],d=0,c=t.children.length;d<c;d++)n[d>=r?d+1:d]=t.children[d];return n[r]=i.id,t.children=n,this.redraw_node(t,!0),this.trigger("create_node",{node:this.get_node(i),parent:t.id,position:r}),s&&s.call(this,this.get_node(i)),i.id},rename_node:function(e,t){var i,r,s;if($.vakata.is_array(e)){for(i=0,r=(e=e.slice()).length;i<r;i++)this.rename_node(e[i],t);return!0}return!(!(e=this.get_node(e))||e.id===$.jstree.root)&&(s=e.text,this.check("rename_node",e,this.get_parent(e),t)?(this.set_text(e,t),this.trigger("rename_node",{node:e,text:t,old:s}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1))},delete_node:function(e){var t,i,r,s,a,n,o,d,c,l,h,_;if($.vakata.is_array(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.delete_node(e[t]);return!0}if(!(e=this.get_node(e))||e.id===$.jstree.root)return!1;if(r=this.get_node(e.parent),s=$.inArray(e.id,r.children),l=!1,!this.check("delete_node",e,r,s))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==s&&(r.children=$.vakata.array_remove(r.children,s)),(a=e.children_d.concat([])).push(e.id),n=0,o=e.parents.length;n<o;n++)this._model.data[e.parents[n]].children_d=$.vakata.array_filter(this._model.data[e.parents[n]].children_d,(function(e){return-1===$.inArray(e,a)}));for(d=0,c=a.length;d<c;d++)if(this._model.data[a[d]].state.selected){l=!0;break}for(l&&(this._data.core.selected=$.vakata.array_filter(this._data.core.selected,(function(e){return-1===$.inArray(e,a)}))),this.trigger("delete_node",{node:e,parent:r.id}),l&&this.trigger("changed",{action:"delete_node",node:e,selected:this._data.core.selected,parent:r.id}),d=0,c=a.length;d<c;d++)delete this._model.data[a[d]];return-1!==$.inArray(this._data.core.focused,a)&&(this._data.core.focused=null,h=this.element[0].scrollTop,_=this.element[0].scrollLeft,r.id===$.jstree.root?this._model.data[$.jstree.root].children[0]&&this.get_node(this._model.data[$.jstree.root].children[0],!0).children(".jstree-anchor").trigger("focus"):this.get_node(r,!0).children(".jstree-anchor").trigger("focus"),this.element[0].scrollTop=h,this.element[0].scrollLeft=_),this.redraw_node(r,!0),!0},check:function(e,t,i,r,s){t=t&&t.id?t:this.get_node(t),i=i&&i.id?i:this.get_node(i);var a=e.match(/^(move_node|copy_node|create_node)$/i)?i:t,n=this.settings.core.check_callback;if("move_node"===e||"copy_node"===e){if(!(s&&s.is_multi||"move_node"!==e||$.inArray(t.id,i.children)!==r))return this._data.core.last_error={error:"check",plugin:"core",id:"core_08",reason:"Moving node to its current position",data:JSON.stringify({chk:e,pos:r,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})},!1;if(!(s&&s.is_multi||t.id!==i.id&&("move_node"!==e||$.inArray(t.id,i.children)!==r)&&-1===$.inArray(i.id,t.children_d)))return this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:e,pos:r,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})},!1}return a&&a.data&&(a=a.data),a&&a.functions&&(!1===a.functions[e]||!0===a.functions[e])?(!1===a.functions[e]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+e,data:JSON.stringify({chk:e,pos:r,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})}),a.functions[e]):!(!1===n||$.vakata.is_function(n)&&!1===n.call(this,e,t,i,r,s)||n&&!1===n[e])||(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+e,data:JSON.stringify({chk:e,pos:r,obj:!(!t||!t.id)&&t.id,par:!(!i||!i.id)&&i.id})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(t,i,r,s,a,n,o){var d,c,l,h,_,u,g,f,p,m,v,j,k,b;if(i=this.get_node(i),r=r===e?0:r,!i)return!1;if(!r.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(i))return this.load_node(i,(function(){this.move_node(t,i,r,s,!0,!1,o)}));if($.vakata.is_array(t)){if(1!==t.length){for(d=0,c=t.length;d<c;d++)(p=this.move_node(t[d],i,r,s,a,!1,o))&&(i=p,r="after");return this.redraw(),!0}t=t[0]}if(!(t=t&&t.id!==e?t:this.get_node(t))||t.id===$.jstree.root)return!1;if(l=(t.parent||$.jstree.root).toString(),_=r.toString().match(/^(before|after)$/)&&i.id!==$.jstree.root?this.get_node(i.parent):i,g=!(u=o||(this._model.data[t.id]?this:$.jstree.reference(t.id)))||!u._id||this._id!==u._id,h=u&&u._id&&l&&u._model.data[l]&&u._model.data[l].children?$.inArray(t.id,u._model.data[l].children):-1,u&&u._id&&(t=u._model.data[t.id]),g)return!!(p=this.copy_node(t,i,r,s,a,!1,o))&&(u&&u.delete_node(t),p);switch(i.id===$.jstree.root&&("before"===r&&(r="first"),"after"===r&&(r="last")),r){case"before":r=$.inArray(i.id,_.children);break;case"after":r=$.inArray(i.id,_.children)+1;break;case"inside":case"first":r=0;break;case"last":r=_.children.length;break;default:r||(r=0)}if(r>_.children.length&&(r=_.children.length),!this.check("move_node",t,_,r,{core:!0,origin:o,is_multi:u&&u._id&&u._id!==this._id,is_foreign:!u||!u._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(t.parent===_.id){for(f=_.children.concat(),-1!==(p=$.inArray(t.id,f))&&(f=$.vakata.array_remove(f,p),r>p&&r--),p=[],m=0,v=f.length;m<v;m++)p[m>=r?m+1:m]=f[m];p[r]=t.id,_.children=p,this._node_changed(_.id),this.redraw(_.id===$.jstree.root)}else{for((p=t.children_d.concat()).push(t.id),m=0,v=t.parents.length;m<v;m++){for(f=[],j=0,k=(b=u._model.data[t.parents[m]].children_d).length;j<k;j++)-1===$.inArray(b[j],p)&&f.push(b[j]);u._model.data[t.parents[m]].children_d=f}for(u._model.data[l].children=$.vakata.array_remove_item(u._model.data[l].children,t.id),m=0,v=_.parents.length;m<v;m++)this._model.data[_.parents[m]].children_d=this._model.data[_.parents[m]].children_d.concat(p);for(f=[],m=0,v=_.children.length;m<v;m++)f[m>=r?m+1:m]=_.children[m];for(f[r]=t.id,_.children=f,_.children_d.push(t.id),_.children_d=_.children_d.concat(t.children_d),t.parent=_.id,(p=_.parents.concat()).unshift(_.id),b=t.parents.length,t.parents=p,p=p.concat(),m=0,v=t.children_d.length;m<v;m++)this._model.data[t.children_d[m]].parents=this._model.data[t.children_d[m]].parents.slice(0,-1*b),Array.prototype.push.apply(this._model.data[t.children_d[m]].parents,p);l!==$.jstree.root&&_.id!==$.jstree.root||(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(l),this._node_changed(_.id)),n||this.redraw()}return s&&s.call(this,t,_,r),this.trigger("move_node",{node:t,parent:_.id,position:r,old_parent:l,old_position:h,is_multi:u&&u._id&&u._id!==this._id,is_foreign:!u||!u._id,old_instance:u,new_instance:this}),t.id},copy_node:function(t,i,r,s,a,n,o){var d,c,l,h,_,u,g,f,p,m;if(i=this.get_node(i),r=r===e?0:r,!i)return!1;if(!r.toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(i))return this.load_node(i,(function(){this.copy_node(t,i,r,s,!0,!1,o)}));if($.vakata.is_array(t)){if(1!==t.length){for(d=0,c=t.length;d<c;d++)(h=this.copy_node(t[d],i,r,s,a,!0,o))&&(i=h,r="after");return this.redraw(),!0}t=t[0]}if(!(t=t&&t.id!==e?t:this.get_node(t))||t.id===$.jstree.root)return!1;switch(f=(t.parent||$.jstree.root).toString(),p=r.toString().match(/^(before|after)$/)&&i.id!==$.jstree.root?this.get_node(i.parent):i,!(m=o||(this._model.data[t.id]?this:$.jstree.reference(t.id)))||!m._id||this._id!==m._id,m&&m._id&&(t=m._model.data[t.id]),i.id===$.jstree.root&&("before"===r&&(r="first"),"after"===r&&(r="last")),r){case"before":r=$.inArray(i.id,p.children);break;case"after":r=$.inArray(i.id,p.children)+1;break;case"inside":case"first":r=0;break;case"last":r=p.children.length;break;default:r||(r=0)}if(r>p.children.length&&(r=p.children.length),!this.check("copy_node",t,p,r,{core:!0,origin:o,is_multi:m&&m._id&&m._id!==this._id,is_foreign:!m||!m._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(g=m?m.get_json(t,{no_id:!0,no_data:!0,no_state:!0}):t))return!1;if(!0===g.id&&delete g.id,!(g=this._parse_model_from_json(g,p.id,p.parents.concat())))return!1;for(h=this.get_node(g),t&&t.state&&!1===t.state.loaded&&(h.state.loaded=!1),(l=[]).push(g),l=l.concat(h.children_d),this.trigger("model",{nodes:l,parent:p.id}),_=0,u=p.parents.length;_<u;_++)this._model.data[p.parents[_]].children_d=this._model.data[p.parents[_]].children_d.concat(l);for(l=[],_=0,u=p.children.length;_<u;_++)l[_>=r?_+1:_]=p.children[_];return l[r]=h.id,p.children=l,p.children_d.push(h.id),p.children_d=p.children_d.concat(h.children_d),p.id===$.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(p.id),n||this.redraw(p.id===$.jstree.root),s&&s.call(this,h,p,r),this.trigger("copy_node",{node:h,original:t,parent:p.id,position:r,old_parent:f,old_position:m&&m._id&&f&&m._model.data[f]&&m._model.data[f].children?$.inArray(t.id,m._model.data[f].children):-1,is_multi:m&&m._id&&m._id!==this._id,is_foreign:!m||!m._id,old_instance:m,new_instance:this}),h.id},cut:function(e){if(e||(e=this._data.core.selected.concat()),$.vakata.is_array(e)||(e=[e]),!e.length)return!1;var t,a,n,o=[];for(a=0,n=e.length;a<n;a++)(t=this.get_node(e[a]))&&(t.id||0===t.id)&&t.id!==$.jstree.root&&o.push(t);if(!o.length)return!1;i=o,s=this,r="move_node",this.trigger("cut",{node:e})},copy:function(t){if(t||(t=this._data.core.selected.concat()),$.vakata.is_array(t)||(t=[t]),!t.length)return!1;var a,n,o,d=[];for(n=0,o=t.length;n<o;n++)(a=this.get_node(t[n]))&&a.id!==e&&a.id!==$.jstree.root&&d.push(a);if(!d.length)return!1;i=d,s=this,r="copy_node",this.trigger("copy",{node:t})},get_buffer:function(){return{mode:r,node:i,inst:s}},can_paste:function(){return!1!==r&&!1!==i},paste:function(e,t){if(!((e=this.get_node(e))&&r&&r.match(/^(copy_node|move_node)$/)&&i))return!1;this[r](i,e,t,!1,!1,!1,s)&&this.trigger("paste",{parent:e.id,node:i,mode:r}),i=!1,r=!1,s=!1},clear_buffer:function(){i=!1,r=!1,s=!1,this.trigger("clear_buffer")},edit:function(e,t,i){var r,s,a,n,d,c,l,h,_,u=!1;return!!(e=this.get_node(e))&&(this.check("edit",e,this.get_parent(e))?(_=e,t="string"==typeof t?t:e.text,this.set_text(e,""),e=this._open_to(e),_.text=t,r=this._data.core.rtl,s=this.element.width(),this._data.core.focused=_.id,a=e.children(".jstree-anchor").trigger("focus"),n=$("<span></span>"),
/*!
			oi = obj.children("i:visible"),
			ai = a.children("i:visible"),
			w1 = oi.width() * oi.length,
			w2 = ai.width() * ai.length,
			*/
d=t,c=$("<div></div>",{css:{position:"absolute",top:"-200px",left:r?"0px":"-1000px",visibility:"hidden"}}).appendTo(o.body),l=$("<input />",{value:d,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:function(t){t.stopImmediatePropagation(),t.preventDefault();var r,s=n.children(".jstree-rename-input").val(),o=this.settings.core.force_text;""===s&&(s=d),c.remove(),n.replaceWith(a),n.remove(),d=o?d:$("<div></div>").append($.parseHTML(d)).html(),e=this.get_node(e),this.set_text(e,d),(r=!!this.rename_node(e,o?$("<div></div>").text(s).text():$("<div></div>").append($.parseHTML(s)).html()))||this.set_text(e,d),this._data.core.focused=_.id,setTimeout(function(){var e=this.get_node(_.id,!0);e.length&&(this._data.core.focused=_.id,e.children(".jstree-anchor").trigger("focus"))}.bind(this),0),i&&i.call(this,_,r,u,s),l=null}.bind(this),keydown:function(e){var t=e.which;27===t&&(u=!0,this.value=d),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){l.width(Math.min(c.text("pW"+this.value).width(),s))},keypress:function(e){if(13===e.which)return!1}}),h={fontFamily:a.css("fontFamily")||"",fontSize:a.css("fontSize")||"",fontWeight:a.css("fontWeight")||"",fontStyle:a.css("fontStyle")||"",fontStretch:a.css("fontStretch")||"",fontVariant:a.css("fontVariant")||"",letterSpacing:a.css("letterSpacing")||"",wordSpacing:a.css("wordSpacing")||""},n.attr("class",a.attr("class")).append(a.contents().clone()).append(l),a.replaceWith(n),c.css(h),l.css(h).width(Math.min(c.text("pW"+l[0].value).width(),s))[0].select(),void $(o).one("mousedown.jstree touchstart.jstree dnd_start.vakata",(function(e){l&&e.target!==l&&$(l).trigger("blur")}))):(this.settings.core.error.call(this,this._data.core.last_error),!1))},set_theme:function(e,t){if(!e)return!1;if(!0===t){var i=this.settings.core.themes.dir;i||(i=$.jstree.path+"/themes"),t=i+"/"+e+"/style.css"}t&&-1===$.inArray(t,a)&&($("head").append('<link rel="stylesheet" href="'+t+'" type="text/css" />'),a.push(t)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=e,this.element.addClass("jstree-"+e),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+e+"-responsive"),this.trigger("set_theme",{theme:e})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped"),this.trigger("show_stripes")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped"),this.trigger("hide_stripes")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots"),this.trigger("show_dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots"),this.trigger("hide_dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons"),this.trigger("show_icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons"),this.trigger("hide_icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},show_ellipsis:function(){this._data.core.themes.ellipsis=!0,this.get_container_ul().addClass("jstree-ellipsis"),this.trigger("show_ellipsis")},hide_ellipsis:function(){this._data.core.themes.ellipsis=!1,this.get_container_ul().removeClass("jstree-ellipsis"),this.trigger("hide_ellipsis")},toggle_ellipsis:function(){this._data.core.themes.ellipsis?this.hide_ellipsis():this.show_ellipsis()},set_icon:function(t,i){var r,s,a,n;if($.vakata.is_array(t)){for(r=0,s=(t=t.slice()).length;r<s;r++)this.set_icon(t[r],i);return!0}return!(!(t=this.get_node(t))||t.id===$.jstree.root)&&(n=t.icon,t.icon=!0===i||null===i||i===e||""===i||i,a=this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===i?(a.removeClass("jstree-themeicon-custom "+n).css("background","").removeAttr("rel"),this.hide_icon(t)):!0===i||null===i||i===e||""===i?(a.removeClass("jstree-themeicon-custom "+n).css("background","").removeAttr("rel"),!1===n&&this.show_icon(t)):-1===i.indexOf("/")&&-1===i.indexOf(".")?(a.removeClass(n).css("background",""),a.addClass(i+" jstree-themeicon-custom").attr("rel",i),!1===n&&this.show_icon(t)):(a.removeClass(n).css("background",""),a.addClass("jstree-themeicon-custom").css("background","url('"+i+"') center center no-repeat").attr("rel",i),!1===n&&this.show_icon(t)),!0)},get_icon:function(e){return!(!(e=this.get_node(e))||e.id===$.jstree.root)&&e.icon},hide_icon:function(e){var t,i;if($.vakata.is_array(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.hide_icon(e[t]);return!0}return!(!(e=this.get_node(e))||e===$.jstree.root)&&(e.icon=!1,this.get_node(e,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(e){var t,i,r;if($.vakata.is_array(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.show_icon(e[t]);return!0}return!(!(e=this.get_node(e))||e===$.jstree.root)&&(r=this.get_node(e,!0),e.icon=!r.length||r.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),e.icon||(e.icon=!0),r.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},$.vakata={},$.vakata.attributes=function(e,t){e=$(e)[0];var i=t?{}:[];return e&&e.attributes&&$.each(e.attributes,(function(e,r){-1===$.inArray(r.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==r.value&&""!==$.vakata.trim(r.value)&&(t?i[r.name]=r.value:i.push(r.name))})),i},$.vakata.array_unique=function(t){var i,r,s=[],a={};for(i=0,r=t.length;i<r;i++)a[t[i]]===e&&(s.push(t[i]),a[t[i]]=!0);return s},$.vakata.array_remove=function(e,t){return e.splice(t,1),e},$.vakata.array_remove_item=function(e,t){var i=$.inArray(t,e);return-1!==i?$.vakata.array_remove(e,i):e},$.vakata.array_filter=function(e,t,i,r,s){if(e.filter)return e.filter(t,i);for(s in r=[],e)~~s+""==s+""&&s>=0&&t.call(i,e[s],+s,e)&&r.push(e[s]);return r},$.vakata.trim=function(e){return String.prototype.trim?String.prototype.trim.call(e.toString()):e.toString().replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},$.vakata.is_function=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},$.vakata.is_array=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Function.prototype.bind||(Function.prototype.bind=function(){var e=this,t=arguments[0],i=Array.prototype.slice.call(arguments,1);if("function"!=typeof e)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");return function(){var r=i.concat(Array.prototype.slice.call(arguments));return e.apply(t,r)}}),$.jstree.plugins.changed=function(e,t){var i=[];this.trigger=function(e,r){var s,a;if(r||(r={}),"changed"===e.replace(".jstree","")){r.changed={selected:[],deselected:[]};var n={};for(s=0,a=i.length;s<a;s++)n[i[s]]=1;for(s=0,a=r.selected.length;s<a;s++)n[r.selected[s]]?n[r.selected[s]]=2:r.changed.selected.push(r.selected[s]);for(s=0,a=i.length;s<a;s++)1===n[i[s]]&&r.changed.deselected.push(i[s]);i=r.selected.slice()}t.trigger.call(this,e,r)},this.refresh=function(e,r){return i=[],t.refresh.apply(this,arguments)}};var l,h,_=o.createElement("I");_.className="jstree-icon jstree-checkbox",_.setAttribute("role","presentation"),$.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0,cascade_to_disabled:!0,cascade_to_hidden:!0},$.jstree.plugins.checkbox=function(t,i){this.bind=function(){i.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")}.bind(this)).on("loading.jstree",function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()}.bind(this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(this._undetermined.bind(this),50)}.bind(this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",function(e,t){var i,r,s=this._model.data,a=(s[t.parent],t.nodes);for(i=0,r=a.length;i<r;i++)s[a[i]].state.checked=s[a[i]].state.checked||s[a[i]].original&&s[a[i]].original.state&&s[a[i]].original.state.checked,s[a[i]].state.checked&&this._data.checkbox.selected.push(a[i])}.bind(this)),-1===this.settings.checkbox.cascade.indexOf("up")&&-1===this.settings.checkbox.cascade.indexOf("down")||this.element.on("model.jstree",function(e,t){var i,r,s,a,n,o,d=this._model.data,c=d[t.parent],l=t.nodes,h=[],_=this.settings.checkbox.cascade,u=this.settings.checkbox.tie_selection;if(-1!==_.indexOf("down"))if(c.state[u?"selected":"checked"]){for(r=0,s=l.length;r<s;r++)d[l[r]].state[u?"selected":"checked"]=!0;this._data[u?"core":"checkbox"].selected=this._data[u?"core":"checkbox"].selected.concat(l)}else for(r=0,s=l.length;r<s;r++)if(d[l[r]].state[u?"selected":"checked"]){for(a=0,n=d[l[r]].children_d.length;a<n;a++)d[d[l[r]].children_d[a]].state[u?"selected":"checked"]=!0;this._data[u?"core":"checkbox"].selected=this._data[u?"core":"checkbox"].selected.concat(d[l[r]].children_d)}if(-1!==_.indexOf("up")){for(r=0,s=c.children_d.length;r<s;r++)d[c.children_d[r]].children.length||h.push(d[c.children_d[r]].parent);for(a=0,n=(h=$.vakata.array_unique(h)).length;a<n;a++)for(c=d[h[a]];c&&c.id!==$.jstree.root;){for(i=0,r=0,s=c.children.length;r<s;r++)i+=d[c.children[r]].state[u?"selected":"checked"];if(i!==s)break;c.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(c.id),(o=this.get_node(c,!0))&&o.length&&o.children(".jstree-anchor").attr("aria-selected",!0).addClass(u?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}}this._data[u?"core":"checkbox"].selected=$.vakata.array_unique(this._data[u?"core":"checkbox"].selected)}.bind(this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",function(e,t){var i,r,s,a,n=t.node,o=this._model.data,d=this.get_node(n.parent),c=this.settings.checkbox.cascade,l=this.settings.checkbox.tie_selection,h={},_=this._data[l?"core":"checkbox"].selected;for(i=0,r=_.length;i<r;i++)h[_[i]]=!0;if(-1!==c.indexOf("down")){var u=this._cascade_new_checked_state(n.id,!0),g=n.children_d.concat(n.id);for(i=0,r=g.length;i<r;i++)u.indexOf(g[i])>-1?h[g[i]]=!0:delete h[g[i]]}if(-1!==c.indexOf("up"))for(;d&&d.id!==$.jstree.root;){for(s=0,i=0,r=d.children.length;i<r;i++)s+=o[d.children[i]].state[l?"selected":"checked"];if(s!==r)break;d.state[l?"selected":"checked"]=!0,h[d.id]=!0,(a=this.get_node(d,!0))&&a.length&&a.children(".jstree-anchor").attr("aria-selected",!0).addClass(l?"jstree-clicked":"jstree-checked"),d=this.get_node(d.parent)}for(i in _=[],h)h.hasOwnProperty(i)&&_.push(i);this._data[l?"core":"checkbox"].selected=_}.bind(this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",function(e,t){var i,r,s,a=this.get_node($.jstree.root),n=this._model.data;for(i=0,r=a.children_d.length;i<r;i++)(s=n[a.children_d[i]])&&s.original&&s.original.state&&s.original.state.undetermined&&(s.original.state.undetermined=!1)}.bind(this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",function(e,t){var i,r,s,a=t.node,n=(this.get_node(a,!0),this.settings.checkbox.cascade),o=this.settings.checkbox.tie_selection,d=this._data[o?"core":"checkbox"].selected,c=a.children_d.concat(a.id);if(-1!==n.indexOf("down")){var l=this._cascade_new_checked_state(a.id,!1);d=$.vakata.array_filter(d,(function(e){return-1===c.indexOf(e)||l.indexOf(e)>-1}))}if(-1!==n.indexOf("up")&&-1===d.indexOf(a.id)){for(i=0,r=a.parents.length;i<r;i++)(s=this._model.data[a.parents[i]]).state[o?"selected":"checked"]=!1,s&&s.original&&s.original.state&&s.original.state.undetermined&&(s.original.state.undetermined=!1),(s=this.get_node(a.parents[i],!0))&&s.length&&s.children(".jstree-anchor").attr("aria-selected",!1).removeClass(o?"jstree-clicked":"jstree-checked");d=$.vakata.array_filter(d,(function(e){return-1===a.parents.indexOf(e)}))}this._data[o?"core":"checkbox"].selected=d}.bind(this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",function(e,t){for(var i,r,s,a,n=this.get_node(t.parent),o=this._model.data,d=this.settings.checkbox.tie_selection;n&&n.id!==$.jstree.root&&!n.state[d?"selected":"checked"];){for(s=0,i=0,r=n.children.length;i<r;i++)s+=o[n.children[i]].state[d?"selected":"checked"];if(!(r>0&&s===r))break;n.state[d?"selected":"checked"]=!0,this._data[d?"core":"checkbox"].selected.push(n.id),(a=this.get_node(n,!0))&&a.length&&a.children(".jstree-anchor").attr("aria-selected",!0).addClass(d?"jstree-clicked":"jstree-checked"),n=this.get_node(n.parent)}}.bind(this)).on("move_node.jstree",function(e,t){var i,r,s,a,n,o=t.is_multi,d=t.old_parent,c=this.get_node(t.parent),l=this._model.data,h=this.settings.checkbox.tie_selection;if(!o)for(i=this.get_node(d);i&&i.id!==$.jstree.root&&!i.state[h?"selected":"checked"];){for(r=0,s=0,a=i.children.length;s<a;s++)r+=l[i.children[s]].state[h?"selected":"checked"];if(!(a>0&&r===a))break;i.state[h?"selected":"checked"]=!0,this._data[h?"core":"checkbox"].selected.push(i.id),(n=this.get_node(i,!0))&&n.length&&n.children(".jstree-anchor").attr("aria-selected",!0).addClass(h?"jstree-clicked":"jstree-checked"),i=this.get_node(i.parent)}for(i=c;i&&i.id!==$.jstree.root;){for(r=0,s=0,a=i.children.length;s<a;s++)r+=l[i.children[s]].state[h?"selected":"checked"];if(r===a)i.state[h?"selected":"checked"]||(i.state[h?"selected":"checked"]=!0,this._data[h?"core":"checkbox"].selected.push(i.id),(n=this.get_node(i,!0))&&n.length&&n.children(".jstree-anchor").attr("aria-selected",!0).addClass(h?"jstree-clicked":"jstree-checked"));else{if(!i.state[h?"selected":"checked"])break;i.state[h?"selected":"checked"]=!1,this._data[h?"core":"checkbox"].selected=$.vakata.array_remove_item(this._data[h?"core":"checkbox"].selected,i.id),(n=this.get_node(i,!0))&&n.length&&n.children(".jstree-anchor").attr("aria-selected",!1).removeClass(h?"jstree-clicked":"jstree-checked")}i=this.get_node(i.parent)}}.bind(this))},this.get_undetermined=function(t){if(-1===this.settings.checkbox.cascade.indexOf("undetermined"))return[];var i,r,s,a,n={},o=this._model.data,d=this.settings.checkbox.tie_selection,c=this._data[d?"core":"checkbox"].selected,l=[],h=this,_=[];for(i=0,r=c.length;i<r;i++)if(o[c[i]]&&o[c[i]].parents)for(s=0,a=o[c[i]].parents.length;s<a&&n[o[c[i]].parents[s]]===e;s++)o[c[i]].parents[s]!==$.jstree.root&&(n[o[c[i]].parents[s]]=!0,l.push(o[c[i]].parents[s]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each((function(){var t,d=h.get_node(this);if(d)if(d.state.loaded){for(i=0,r=d.children_d.length;i<r;i++)if(!(t=o[d.children_d[i]]).state.loaded&&t.original&&t.original.state&&t.original.state.undetermined&&!0===t.original.state.undetermined)for(n[t.id]===e&&t.id!==$.jstree.root&&(n[t.id]=!0,l.push(t.id)),s=0,a=t.parents.length;s<a;s++)n[t.parents[s]]===e&&t.parents[s]!==$.jstree.root&&(n[t.parents[s]]=!0,l.push(t.parents[s]))}else if(d.original&&d.original.state&&d.original.state.undetermined&&!0===d.original.state.undetermined)for(n[d.id]===e&&d.id!==$.jstree.root&&(n[d.id]=!0,l.push(d.id)),s=0,a=d.parents.length;s<a;s++)n[d.parents[s]]===e&&d.parents[s]!==$.jstree.root&&(n[d.parents[s]]=!0,l.push(d.parents[s]))})),i=0,r=l.length;i<r;i++)o[l[i]].state[d?"selected":"checked"]||_.push(t?o[l[i]]:l[i]);return _},this._undetermined=function(){if(null!==this.element){var e,t,i,r=this.get_undetermined(!1);for(this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),e=0,t=r.length;e<t;e++)(i=this.get_node(r[e],!0))&&i.length&&i.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}},this.redraw_node=function(e,t,r,s){if(e=i.redraw_node.apply(this,arguments)){var a,n,o=null,d=null;for(a=0,n=e.childNodes.length;a<n;a++)if(e.childNodes[a]&&e.childNodes[a].className&&-1!==e.childNodes[a].className.indexOf("jstree-anchor")){o=e.childNodes[a];break}o&&(!this.settings.checkbox.tie_selection&&this._model.data[e.id].state.checked&&(o.className+=" jstree-checked"),d=_.cloneNode(!1),this._model.data[e.id].state.checkbox_disabled&&(d.className+=" jstree-checkbox-disabled"),o.insertBefore(d,o.childNodes[0]))}return r||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(this._undetermined.bind(this),50)),e},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(e){e=this.get_node(e);var t,i,r=this.settings.checkbox.cascade,s=this.settings.checkbox.tie_selection,a=this._data[s?"core":"checkbox"].selected,n=this._model.data;if(!e||!0===e.state[s?"selected":"checked"]||-1===r.indexOf("undetermined")||-1===r.indexOf("down")&&-1===r.indexOf("up"))return!1;if(!e.state.loaded&&!0===e.original.state.undetermined)return!0;for(t=0,i=e.children_d.length;t<i;t++)if(-1!==$.inArray(e.children_d[t],a)||!n[e.children_d[t]].state.loaded&&n[e.children_d[t]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(e){var t,i,r;if($.vakata.is_array(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.disable_checkbox(e[t]);return!0}if(!(e=this.get_node(e))||e.id===$.jstree.root)return!1;r=this.get_node(e,!0),e.state.checkbox_disabled||(e.state.checkbox_disabled=!0,r&&r.length&&r.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:e}))},this.enable_checkbox=function(e){var t,i,r;if($.vakata.is_array(e)){for(t=0,i=(e=e.slice()).length;t<i;t++)this.enable_checkbox(e[t]);return!0}if(!(e=this.get_node(e))||e.id===$.jstree.root)return!1;r=this.get_node(e,!0),e.state.checkbox_disabled&&(e.state.checkbox_disabled=!1,r&&r.length&&r.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:e}))},this.activate_node=function(e,t){return!$(t.target).hasClass("jstree-checkbox-disabled")&&(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||$(t.target).hasClass("jstree-checkbox"))&&(t.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!$(t.target).hasClass("jstree-checkbox")?i.activate_node.call(this,e,t):!this.is_disabled(e)&&(this.is_checked(e)?this.uncheck_node(e,t):this.check_node(e,t),void this.trigger("activate_node",{node:this.get_node(e)})))},this.delete_node=function(e){if(this.settings.checkbox.tie_selection||$.vakata.is_array(e))return i.delete_node.call(this,e);var t,r,s,a=!1;if(!(e=this.get_node(e))||e.id===$.jstree.root)return!1;for((t=e.children_d.concat([])).push(e.id),r=0,s=t.length;r<s;r++)if(this._model.data[t[r]].state.checked){a=!0;break}return a&&(this._data.checkbox.selected=$.vakata.array_filter(this._data.checkbox.selected,(function(e){return-1===$.inArray(e,t)}))),i.delete_node.call(this,e)},this._cascade_new_checked_state=function(e,t){var i,r,s,a=this.settings.checkbox.tie_selection,n=this._model.data[e],o=[],d=[];if(!this.settings.checkbox.cascade_to_disabled&&n.state.disabled||!this.settings.checkbox.cascade_to_hidden&&n.state.hidden)s=this.get_checked_descendants(e),n.state[a?"selected":"checked"]&&s.push(n.id),o=o.concat(s);else{if(n.children)for(i=0,r=n.children.length;i<r;i++){var c=n.children[i];s=this._cascade_new_checked_state(c,t),o=o.concat(s),s.indexOf(c)>-1&&d.push(c)}var l=this.get_node(n,!0),h=d.length>0&&d.length<n.children.length;n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=h),h?(n.state[a?"selected":"checked"]=!1,l.children(".jstree-anchor").attr("aria-selected",!1).removeClass(a?"jstree-clicked":"jstree-checked")):t&&d.length===n.children.length?(n.state[a?"selected":"checked"]=t,o.push(n.id),l.children(".jstree-anchor").attr("aria-selected",!0).addClass(a?"jstree-clicked":"jstree-checked")):(n.state[a?"selected":"checked"]=!1,l.children(".jstree-anchor").attr("aria-selected",!1).removeClass(a?"jstree-clicked":"jstree-checked"))}return o},this.get_checked_descendants=function(e){var t=this,i=t.settings.checkbox.tie_selection,r=t._model.data[e];return $.vakata.array_filter(r.children_d,(function(e){return t._model.data[e].state[i?"selected":"checked"]}))},this.check_node=function(e,t){if(this.settings.checkbox.tie_selection)return this.select_node(e,!1,!0,t);var i,r,s;if($.vakata.is_array(e)){for(r=0,s=(e=e.slice()).length;r<s;r++)this.check_node(e[r],t);return!0}if(!(e=this.get_node(e))||e.id===$.jstree.root)return!1;i=this.get_node(e,!0),e.state.checked||(e.state.checked=!0,this._data.checkbox.selected.push(e.id),i&&i.length&&i.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:e,selected:this._data.checkbox.selected,event:t}))},this.uncheck_node=function(e,t){if(this.settings.checkbox.tie_selection)return this.deselect_node(e,!1,t);var i,r,s;if($.vakata.is_array(e)){for(i=0,r=(e=e.slice()).length;i<r;i++)this.uncheck_node(e[i],t);return!0}if(!(e=this.get_node(e))||e.id===$.jstree.root)return!1;s=this.get_node(e,!0),e.state.checked&&(e.state.checked=!1,this._data.checkbox.selected=$.vakata.array_remove_item(this._data.checkbox.selected,e.id),s.length&&s.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:e,selected:this._data.checkbox.selected,event:t}))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var e,t;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data[$.jstree.root].children_d.concat(),e=0,t=this._data.checkbox.selected.length;e<t;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var e,t,i=this._data.checkbox.selected.concat([]);for(e=0,t=this._data.checkbox.selected.length;e<t;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:i})},this.is_checked=function(e){return this.settings.checkbox.tie_selection?this.is_selected(e):!(!(e=this.get_node(e))||e.id===$.jstree.root)&&e.state.checked},this.get_checked=function(e){return this.settings.checkbox.tie_selection?this.get_selected(e):e?$.map(this._data.checkbox.selected,function(e){return this.get_node(e)}.bind(this)):this._data.checkbox.selected.slice()},this.get_top_checked=function(e){if(this.settings.checkbox.tie_selection)return this.get_top_selected(e);var t,i,r,s,a=this.get_checked(!0),n={};for(t=0,i=a.length;t<i;t++)n[a[t].id]=a[t];for(t=0,i=a.length;t<i;t++)for(r=0,s=a[t].children_d.length;r<s;r++)n[a[t].children_d[r]]&&delete n[a[t].children_d[r]];for(t in a=[],n)n.hasOwnProperty(t)&&a.push(t);return e?$.map(a,function(e){return this.get_node(e)}.bind(this)):a},this.get_bottom_checked=function(e){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(e);var t,i,r=this.get_checked(!0),s=[];for(t=0,i=r.length;t<i;t++)r[t].children.length||s.push(r[t].id);return e?$.map(s,function(e){return this.get_node(e)}.bind(this)):s},this.load_node=function(e,t){var r,s,a;if(!$.vakata.is_array(e)&&!this.settings.checkbox.tie_selection&&(a=this.get_node(e))&&a.state.loaded)for(r=0,s=a.children_d.length;r<s;r++)this._model.data[a.children_d[r]].state.checked&&(!0,this._data.checkbox.selected=$.vakata.array_remove_item(this._data.checkbox.selected,a.children_d[r]));return i.load_node.apply(this,arguments)},this.get_state=function(){var e=i.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection||(e.checkbox=this._data.checkbox.selected.slice()),e},this.set_state=function(e,t){var r=i.set_state.apply(this,arguments);if(r&&e.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var s=this;$.each(e.checkbox,(function(e,t){s.check_node(t)}))}return delete e.checkbox,this.set_state(e,t),!1}return r},this.refresh=function(e,t){return this.settings.checkbox.tie_selection&&(this._data.checkbox.selected=[]),i.refresh.apply(this,arguments)}},$.jstree.defaults.conditionalselect=function(){return!0},$.jstree.plugins.conditionalselect=function(e,t){this.activate_node=function(e,i){if(this.settings.conditionalselect.call(this,this.get_node(e),i))return t.activate_node.call(this,e,i)}},$.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(e,t){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(e){var t=$.jstree.reference(e.reference),i=t.get_node(e.reference);t.create_node(i,{},"last",(function(e){try{t.edit(e)}catch(i){setTimeout((function(){t.edit(e)}),0)}}))}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",
/*!
					"shortcut"			: 113,
					"shortcut_label"	: 'F2',
					"icon"				: "glyphicon glyphicon-leaf",
					*/
action:function(e){var t=$.jstree.reference(e.reference),i=t.get_node(e.reference);t.edit(i)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(e){var t=$.jstree.reference(e.reference),i=t.get_node(e.reference);t.is_selected(i)?t.delete_node(t.get_selected()):t.delete_node(i)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(e){var t=$.jstree.reference(e.reference),i=t.get_node(e.reference);t.is_selected(i)?t.cut(t.get_top_selected()):t.cut(i)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(e){var t=$.jstree.reference(e.reference),i=t.get_node(e.reference);t.is_selected(i)?t.copy(t.get_top_selected()):t.copy(i)}},paste:{separator_before:!1,icon:!1,_disabled:function(e){return!$.jstree.reference(e.reference).can_paste()},separator_after:!1,label:"Paste",action:function(e){var t=$.jstree.reference(e.reference),i=t.get_node(e.reference);t.paste(i)}}}}}}},$.jstree.plugins.contextmenu=function(t,i){this.bind=function(){i.bind.call(this);var e,t,r=0,s=null;this.element.on("init.jstree loading.jstree ready.jstree",function(){this.get_container_ul().addClass("jstree-contextmenu")}.bind(this)).on("contextmenu.jstree",".jstree-anchor",function(e,t){"input"!==e.target.tagName.toLowerCase()&&(e.preventDefault(),r=e.ctrlKey?+new Date:0,(t||s)&&(r=+new Date+1e4),s&&clearTimeout(s),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e))}.bind(this)).on("click.jstree",".jstree-anchor",function(e){this._data.contextmenu.visible&&(!r||+new Date-r>250)&&$.vakata.context.hide(),r=0}.bind(this)).on("touchstart.jstree",".jstree-anchor",(function(i){i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(e=i.originalEvent.changedTouches[0].clientX,t=i.originalEvent.changedTouches[0].clientY,s=setTimeout((function(){$(i.currentTarget).trigger("contextmenu",!0)}),750))})).on("touchmove.vakata.jstree",(function(i){s&&i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(Math.abs(e-i.originalEvent.changedTouches[0].clientX)>10||Math.abs(t-i.originalEvent.changedTouches[0].clientY)>10)&&(clearTimeout(s),$.vakata.context.hide())})).on("touchend.vakata.jstree",(function(e){s&&clearTimeout(s)})),
/*!
			if(!('oncontextmenu' in document.body) && ('ontouchstart' in document.body)) {
				var el = null, tm = null;
				this.element
					.on("touchstart", ".jstree-anchor", function (e) {
						el = e.currentTarget;
						tm = +new Date();
						$(document).one("touchend", function (e) {
							e.target = document.elementFromPoint(e.originalEvent.targetTouches[0].pageX - window.pageXOffset, e.originalEvent.targetTouches[0].pageY - window.pageYOffset);
							e.currentTarget = e.target;
							tm = ((+(new Date())) - tm);
							if(e.target === el && tm > 600 && tm < 1000) {
								e.preventDefault();
								$(el).trigger('contextmenu', e);
							}
							el = null;
							tm = null;
						});
					});
			}
			*/
$(o).on("context_hide.vakata.jstree",function(e,t){this._data.contextmenu.visible=!1,$(t.reference).removeClass("jstree-context")}.bind(this))},this.teardown=function(){this._data.contextmenu.visible&&$.vakata.context.hide(),$(o).off("context_hide.vakata.jstree"),i.teardown.call(this)},this.show_contextmenu=function(t,i,r,s){if(!(t=this.get_node(t))||t.id===$.jstree.root)return!1;var a=this.settings.contextmenu,n=this.get_node(t,!0).children(".jstree-anchor"),o=!1,d=!1;(a.show_at_node||i===e||r===e)&&(o=n.offset(),i=o.left,r=o.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(t)&&this.activate_node(t,s),d=a.items,$.vakata.is_function(d)&&(d=d.call(this,t,function(e){this._show_contextmenu(t,i,r,e)}.bind(this))),$.isPlainObject(d)&&this._show_contextmenu(t,i,r,d)},this._show_contextmenu=function(e,t,i,r){var s=this.get_node(e,!0).children(".jstree-anchor");$(o).one("context_show.vakata.jstree",function(e,t){var i="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";$(t.element).addClass(i),s.addClass("jstree-context")}.bind(this)),this._data.contextmenu.visible=!0,$.vakata.context.show(s,{x:t,y:i},r),this.trigger("show_contextmenu",{node:e,x:t,y:i})}},function($){var e=!1,t={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};$.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(e){$(o).triggerHandler("context_"+e+".vakata",{reference:t.reference,element:t.element,position:{x:t.position_x,y:t.position_y}})},_execute:function(e){return!(!(e=t.items[e])||e._disabled&&(!$.vakata.is_function(e._disabled)||e._disabled({item:e,reference:t.reference,element:t.element}))||!e.action)&&e.action.call(null,{item:e,reference:t.reference,element:t.element,position:{x:t.position_x,y:t.position_y}})},_parse:function(e,i){if(!e)return!1;i||(t.html="",t.items=[]);var r,s="",a=!1;return i&&(s+="<ul>"),$.each(e,(function(e,i){if(!i)return!0;t.items.push(i),!a&&i.separator_before&&(s+="<li class='vakata-context-separator'><a href='#' "+($.vakata.context.settings.icons?"":'class="vakata-context-no-icons"')+">&#160;</a></li>"),a=!1,s+="<li class='"+(i._class||"")+(!0===i._disabled||$.vakata.is_function(i._disabled)&&i._disabled({item:i,reference:t.reference,element:t.element})?" vakata-contextmenu-disabled ":"")+"' "+(i.shortcut?" data-shortcut='"+i.shortcut+"' ":"")+">",s+="<a href='#' rel='"+(t.items.length-1)+"' "+(i.title?"title='"+i.title+"'":"")+">",$.vakata.context.settings.icons&&(s+="<i ",i.icon&&(-1!==i.icon.indexOf("/")||-1!==i.icon.indexOf(".")?s+=" style='background:url(\""+i.icon+"\") center center no-repeat' ":s+=" class='"+i.icon+"' "),s+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),s+=($.vakata.is_function(i.label)?i.label({item:e,reference:t.reference,element:t.element}):i.label)+(i.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+i.shortcut+'">'+(i.shortcut_label||"")+"</span>":"")+"</a>",i.submenu&&(r=$.vakata.context._parse(i.submenu,!0))&&(s+=r),s+="</li>",i.separator_after&&(s+="<li class='vakata-context-separator'><a href='#' "+($.vakata.context.settings.icons?"":'class="vakata-context-no-icons"')+">&#160;</a></li>",a=!0)})),s=s.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),i&&(s+="</ul>"),i||(t.html=s,$.vakata.context._trigger("parse")),s.length>10&&s},_show_submenu:function(t){if((t=$(t)).length&&t.children("ul").length){var i=t.children("ul"),r=t.offset().left,s=r+t.outerWidth(),a=t.offset().top,n=i.width(),o=i.height(),d=$(window).width()+$(window).scrollLeft(),c=$(window).height()+$(window).scrollTop();e?t[s-(n+10+t.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):t[s+n>d&&r>d-s?"addClass":"removeClass"]("vakata-context-right"),a+o+10>c&&i.css("bottom","-1px"),t.hasClass("vakata-context-right")?r<n&&i.css("margin-right",r-n):d-s<n&&i.css("margin-left",d-s-n),i.show()}},show:function(i,r,s){var a,n,d,c,l,h,_,u;switch(t.element&&t.element.length&&t.element.width(""),!0){case!r&&!i:return!1;case!!r&&!!i:t.reference=i,t.position_x=r.x,t.position_y=r.y;break;case!r&&!!i:t.reference=i,a=i.offset(),t.position_x=a.left+i.outerHeight(),t.position_y=a.top;break;case!!r&&!i:t.position_x=r.x,t.position_y=r.y}i&&!s&&$(i).data("vakata_contextmenu")&&(s=$(i).data("vakata_contextmenu")),$.vakata.context._parse(s)&&t.element.html(t.html),t.items.length&&(t.element.appendTo(o.body),n=t.element,d=t.position_x,c=t.position_y,l=n.width(),h=n.height(),_=$(window).width()+$(window).scrollLeft(),u=$(window).height()+$(window).scrollTop(),e&&(d-=n.outerWidth()-$(i).outerWidth())<$(window).scrollLeft()+20&&(d=$(window).scrollLeft()+20),d+l+20>_&&(d=_-(l+20)),c+h+20>u&&(c=u-(h+20)),t.element.css({left:d,top:c}).show().find("a").first().trigger("focus").parent().addClass("vakata-context-hover"),t.is_visible=!0,$.vakata.context._trigger("show"))},hide:function(){t.is_visible&&(t.element.hide().find("ul").hide().end().find(":focus").trigger("blur").end().detach(),t.is_visible=!1,$.vakata.context._trigger("hide"))}},$((function(){e="rtl"===$(o.body).css("direction");var i=!1;t.element=$("<ul class='vakata-context'></ul>"),t.element.on("mouseenter","li",(function(e){e.stopImmediatePropagation(),$.contains(this,e.relatedTarget)||(i&&clearTimeout(i),t.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),$(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),$.vakata.context._show_submenu(this))})).on("mouseleave","li",(function(e){$.contains(this,e.relatedTarget)||$(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")})).on("mouseleave",(function(e){$(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),$.vakata.context.settings.hide_onmouseleave&&(i=setTimeout((function(){$.vakata.context.hide()}),$.vakata.context.settings.hide_onmouseleave))})).on("click","a",(function(e){e.preventDefault(),$(this).trigger("blur").parent().hasClass("vakata-context-disabled")||!1===$.vakata.context._execute($(this).attr("rel"))||$.vakata.context.hide()})).on("keydown","a",(function(e){var i=null;switch(e.which){case 13:case 32:e.type="click",e.preventDefault(),$(e.currentTarget).trigger(e);break;case 37:t.is_visible&&(t.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").trigger("focus"),e.stopImmediatePropagation(),e.preventDefault());break;case 38:t.is_visible&&((i=t.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first()).length||(i=t.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),i.addClass("vakata-context-hover").children("a").trigger("focus"),e.stopImmediatePropagation(),e.preventDefault());break;case 39:t.is_visible&&(t.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").trigger("focus"),e.stopImmediatePropagation(),e.preventDefault());break;case 40:t.is_visible&&((i=t.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first()).length||(i=t.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),i.addClass("vakata-context-hover").children("a").trigger("focus"),e.stopImmediatePropagation(),e.preventDefault());break;case 27:$.vakata.context.hide(),e.preventDefault()}})).on("keydown",(function(e){e.preventDefault();var i=t.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();i.parent().not(".vakata-context-disabled")&&i.trigger("click")})),$(o).on("mousedown.vakata.jstree",(function(e){t.is_visible&&t.element[0]!==e.target&&!$.contains(t.element[0],e.target)&&$.vakata.context.hide()})).on("context_show.vakata.jstree",(function(i,r){t.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),e&&t.element.addClass("vakata-context-rtl").css("direction","rtl"),t.element.find("ul").hide().end()}))}))}($),$.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1,blank_space_drop:!1},$.jstree.plugins.dnd=function(e,t){this.init=function(e,i){t.init.call(this,e,i),this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in o.createElement("span")},this.bind=function(){t.bind.call(this),this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",function(e){if(this.settings.dnd.large_drag_target&&$(e.target).closest(".jstree-node")[0]!==e.currentTarget)return!0;if("touchstart"===e.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!$(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var t=this.get_node(e.target),i=this.is_selected(t)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,r=i>1?i+" "+this.get_string("nodes"):this.get_text(e.currentTarget);if(this.settings.core.force_text&&(r=$.vakata.html.escape(r)),t&&(t.id||0===t.id)&&t.id!==$.jstree.root&&(1===e.which||"touchstart"===e.type||"dragstart"===e.type)&&(!0===this.settings.dnd.is_draggable||$.vakata.is_function(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,i>1?this.get_top_selected(!0):[t],e))){if(l={jstree:!0,origin:this,obj:this.get_node(t,!0),nodes:i>1?this.get_top_selected():[t.id]},h=e.currentTarget,!this.settings.dnd.use_html5)return this.element.trigger("mousedown.jstree"),$.vakata.dnd.start(e,l,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+r+'<ins class="jstree-copy">+</ins></div>');$.vakata.dnd._trigger("start",e,{helper:$(),element:h,data:l})}}.bind(this)),this.settings.dnd.use_html5&&this.element.on("dragover.jstree",(function(e){return e.preventDefault(),$.vakata.dnd._trigger("move",e,{helper:$(),element:h,data:l}),!1})).on("drop.jstree",function(e){return e.preventDefault(),$.vakata.dnd._trigger("stop",e,{helper:$(),element:h,data:l}),!1}.bind(this))},this.redraw_node=function(e,i,r,s){if((e=t.redraw_node.apply(this,arguments))&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)e.setAttribute("draggable",!0);else{var a,n,o=null;for(a=0,n=e.childNodes.length;a<n;a++)if(e.childNodes[a]&&e.childNodes[a].className&&-1!==e.childNodes[a].className.indexOf("jstree-anchor")){o=e.childNodes[a];break}o&&o.setAttribute("draggable",!0)}return e}},$((function(){var t=!1,i=!1,r=!1,s=!1,a=$('<div id="jstree-marker">&#160;</div>').hide();$(o).on("dragover.vakata.jstree",(function(e){h&&$.vakata.dnd._trigger("move",e,{helper:$(),element:h,data:l})})).on("drop.vakata.jstree",(function(e){h&&($.vakata.dnd._trigger("stop",e,{helper:$(),element:h,data:l}),h=null,l=null)})).on("dnd_start.vakata.jstree",(function(e,i){t=!1,r=!1,i&&i.data&&i.data.jstree&&a.appendTo(o.body)})).on("dnd_move.vakata.jstree",(function(n,o){var d=o.event.target!==r.target;if(s&&(o.event&&"dragover"===o.event.type&&!d||clearTimeout(s)),o&&o.data&&o.data.jstree&&(!o.event.target.id||"jstree-marker"!==o.event.target.id)){r=o.event;var c,l,h,_,u,g,f,p,m,v,j,k,b,y,x,w,C,T=$.jstree.reference(o.event.target),N=!1,O=!1,A=!1;if(T&&T._data&&T._data.dnd)if(a.attr("class","jstree-"+T.get_theme()+(T.settings.core.themes.responsive?" jstree-dnd-responsive":"")),x=o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey)),o.helper.children().attr("class","jstree-"+T.get_theme()+" jstree-"+T.get_theme()+"-"+T.get_theme_variant()+" "+(T.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[x?"show":"hide"](),o.event.target!==T.element[0]&&o.event.target!==T.get_container_ul()[0]||0!==T.get_container_ul().children().length&&!T.settings.dnd.blank_space_drop){if((N=T.settings.dnd.large_drop_target?$(o.event.target).closest(".jstree-node").children(".jstree-anchor"):$(o.event.target).closest(".jstree-anchor"))&&N.length&&N.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(O=N.offset(),A=(o.event.pageY!==e?o.event.pageY:o.event.originalEvent.pageY)-O.top,h=N.outerHeight(),g=A<h/3?["b","i","a"]:A>h-h/3?["a","i","b"]:A>h/2?["i","a","b"]:["i","b","a"],$.each(g,(function(e,r){switch(r){case"b":c=O.left-6,l=O.top,_=T.get_parent(N),u=N.parent().index(),C="jstree-below";break;case"i":b=T.settings.dnd.inside_pos,y=T.get_node(N.parent()),c=O.left-2,l=O.top+h/2+1,_=y.id,u="first"===b?0:"last"===b?y.children.length:Math.min(b,y.children.length),C="jstree-inside";break;case"a":c=O.left-6,l=O.top+h,_=T.get_parent(N),u=N.parent().index()+1,C="jstree-above"}for(f=!0,p=0,m=o.data.nodes.length;p<m;p++)if(v=o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node",j=u,"move_node"===v&&"a"===r&&o.data.origin&&o.data.origin===T&&_===T.get_parent(o.data.nodes[p])&&(k=T.get_node(_),j>$.inArray(o.data.nodes[p],k.children)&&(j-=1)),!(f=f&&(T&&T.settings&&T.settings.dnd&&!1===T.settings.dnd.check_while_dragging||T.check(v,o.data.origin&&o.data.origin!==T?o.data.origin.get_node(o.data.nodes[p]):o.data.nodes[p],_,j,{dnd:!0,ref:T.get_node(N.parent()),pos:r,origin:o.data.origin,is_multi:o.data.origin&&o.data.origin!==T,is_foreign:!o.data.origin})))){T&&T.last_error&&(i=T.last_error());break}var n,A;if("i"===r&&N.parent().is(".jstree-closed")&&T.settings.dnd.open_timeout&&(o.event&&"dragover"===o.event.type&&!d||(s&&clearTimeout(s),s=setTimeout((n=T,A=N,function(){n.open_node(A)}),T.settings.dnd.open_timeout))),f)return(w=T.get_node(_,!0)).hasClass(".jstree-dnd-parent")||($(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),w.addClass("jstree-dnd-parent")),t={ins:T,par:_,pos:"i"!==r||"last"!==b||0!==u||T.is_loaded(y)?u:"last"},a.css({left:c+"px",top:l+"px"}).show(),a.removeClass("jstree-above jstree-inside jstree-below").addClass(C),o.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),o.event.originalEvent&&o.event.originalEvent.dataTransfer&&(o.event.originalEvent.dataTransfer.dropEffect=x?"copy":"move"),i={},g=!0,!1})),!0===g))return}else{for(f=!0,p=0,m=o.data.nodes.length;p<m&&(f=f&&T.check(o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node",o.data.origin&&o.data.origin!==T?o.data.origin.get_node(o.data.nodes[p]):o.data.nodes[p],$.jstree.root,"last",{dnd:!0,ref:T.get_node($.jstree.root),pos:"i",origin:o.data.origin,is_multi:o.data.origin&&o.data.origin!==T,is_foreign:!o.data.origin}));p++);if(f)return t={ins:T,par:$.jstree.root,pos:"last"},a.hide(),o.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),void(o.event.originalEvent&&o.event.originalEvent.dataTransfer&&(o.event.originalEvent.dataTransfer.dropEffect=x?"copy":"move"))}$(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),t=!1,o.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),o.event.originalEvent&&o.event.originalEvent.dataTransfer,a.hide()}})).on("dnd_scroll.vakata.jstree",(function(e,i){i&&i.data&&i.data.jstree&&(a.hide(),t=!1,r=!1,i.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))})).on("dnd_stop.vakata.jstree",(function(e,n){if($(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),s&&clearTimeout(s),n&&n.data&&n.data.jstree){a.hide().detach();var o,d,c=[];if(t){for(o=0,d=n.data.nodes.length;o<d;o++)c[o]=n.data.origin?n.data.origin.get_node(n.data.nodes[o]):n.data.nodes[o];t.ins[n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(n.event.metaKey||n.event.ctrlKey))?"copy_node":"move_node"](c,t.par,t.pos,!1,!1,!1,n.data.origin)}else(o=$(n.event.target).closest(".jstree")).length&&i&&i.error&&"check"===i.error&&(o=o.jstree(!0))&&o.settings.core.error.call(this,i);r=!1,t=!1}})).on("keyup.jstree keydown.jstree",(function(e,n){(n=$.vakata.dnd._get())&&n.data&&n.data.jstree&&("keyup"===e.type&&27===e.which?(s&&clearTimeout(s),t=!1,i=!1,r=!1,s=!1,a.hide().detach(),$.vakata.dnd._clean()):(n.helper.find(".jstree-copy").first()[n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(e.metaKey||e.ctrlKey))?"show":"hide"](),r&&(r.metaKey=e.metaKey,r.ctrlKey=e.ctrlKey,$.vakata.dnd._trigger("move",r))))}))})),function($){$.vakata.html={div:$("<div></div>"),escape:function(e){return $.vakata.html.div.text(e).html()},strip:function(e){return $.vakata.html.div.empty().append($.parseHTML(e)).text()}};var t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};$.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:10},_trigger:function(t,i,r){r===e&&(r=$.vakata.dnd._get()),r.event=i,$(o).triggerHandler("dnd_"+t+".vakata",r)},_get:function(){return{data:t.data,element:t.element,helper:t.helper}},_clean:function(){t.helper&&t.helper.remove(),t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1),t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},h=null,$(o).off("mousemove.vakata.jstree touchmove.vakata.jstree",$.vakata.dnd.drag),$(o).off("mouseup.vakata.jstree touchend.vakata.jstree",$.vakata.dnd.stop)},_scroll:function(e){if(!t.scroll_e||!t.scroll_l&&!t.scroll_t)return t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1),!1;if(!t.scroll_i)return t.scroll_i=setInterval($.vakata.dnd._scroll,100),!1;if(!0===e)return!1;var i=t.scroll_e.scrollTop(),r=t.scroll_e.scrollLeft();t.scroll_e.scrollTop(i+t.scroll_t*$.vakata.dnd.settings.scroll_speed),t.scroll_e.scrollLeft(r+t.scroll_l*$.vakata.dnd.settings.scroll_speed),i===t.scroll_e.scrollTop()&&r===t.scroll_e.scrollLeft()||$.vakata.dnd._trigger("scroll",t.scroll_e)},start:function(e,i,r){"touchstart"===e.type&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e.target=o.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_drag&&$.vakata.dnd.stop({});try{e.currentTarget.unselectable="on",e.currentTarget.onselectstart=function(){return!1},e.currentTarget.style&&(e.currentTarget.style.touchAction="none",e.currentTarget.style.msTouchAction="none",e.currentTarget.style.MozUserSelect="none")}catch(e){}return t.init_x=e.pageX,t.init_y=e.pageY,t.data=i,t.is_down=!0,t.element=e.currentTarget,t.target=e.target,t.is_touch="touchstart"===e.type,!1!==r&&(t.helper=$("<div id='vakata-dnd'></div>").html(r).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),$(o).on("mousemove.vakata.jstree touchmove.vakata.jstree",$.vakata.dnd.drag),$(o).on("mouseup.vakata.jstree touchend.vakata.jstree",$.vakata.dnd.stop),!1},drag:function(e){if("touchmove"===e.type&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e.target=o.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_down){if(!t.is_drag){if(!(Math.abs(e.pageX-t.init_x)>(t.is_touch?$.vakata.dnd.settings.threshold_touch:$.vakata.dnd.settings.threshold)||Math.abs(e.pageY-t.init_y)>(t.is_touch?$.vakata.dnd.settings.threshold_touch:$.vakata.dnd.settings.threshold)))return;t.helper&&(t.helper.appendTo(o.body),t.helper_w=t.helper.outerWidth()),t.is_drag=!0,$(t.target).one("click.vakata",!1),$.vakata.dnd._trigger("start",e)}var i=!1,r=!1,s=!1,a=!1,n=!1,d=!1,c=!1,l=!1,h=!1,_=!1;return t.scroll_t=0,t.scroll_l=0,t.scroll_e=!1,$($(e.target).parentsUntil("body").addBack().get().reverse()).filter((function(){return this.ownerDocument&&/^auto|scroll$/.test($(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)})).each((function(){var i=$(this),r=i.offset();if(this.scrollHeight>this.offsetHeight&&(r.top+i.height()-e.pageY<$.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),e.pageY-r.top<$.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(r.left+i.width()-e.pageX<$.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1),e.pageX-r.left<$.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1)),t.scroll_t||t.scroll_l)return t.scroll_e=$(this),!1})),t.scroll_e||(i=$(o),r=$(window),s=i.height(),a=r.height(),n=i.width(),d=r.width(),c=i.scrollTop(),l=i.scrollLeft(),s>a&&e.pageY-c<$.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1),s>a&&a-(e.pageY-c)<$.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),n>d&&e.pageX-l<$.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1),n>d&&d-(e.pageX-l)<$.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1),(t.scroll_t||t.scroll_l)&&(t.scroll_e=i)),t.scroll_e&&$.vakata.dnd._scroll(!0),t.helper&&(h=parseInt(e.pageY+$.vakata.dnd.settings.helper_top,10),_=parseInt(e.pageX+$.vakata.dnd.settings.helper_left,10),s&&h+25>s&&(h=s-50),n&&_+t.helper_w>n&&(_=n-(t.helper_w+2)),t.helper.css({left:_+"px",top:h+"px"})),$.vakata.dnd._trigger("move",e),!1}},stop:function(e){if("touchend"===e.type&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e.target=o.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_drag)e.target!==t.target&&$(t.target).off("click.vakata"),$.vakata.dnd._trigger("stop",e);else if("touchend"===e.type&&e.target===t.target){var i=setTimeout((function(){$(e.target).trigger("click")}),100);$(e.target).one("click",(function(){i&&clearTimeout(i)}))}return $.vakata.dnd._clean(),!1}}}($),$.jstree.defaults.massload=null,$.jstree.plugins.massload=function(e,t){this.init=function(e,i){this._data.massload={},t.init.call(this,e,i)},this._load_nodes=function(e,i,r,s){var a,n,o,d=this.settings.massload,c=[],l=this._model.data;if(!r){for(a=0,n=e.length;a<n;a++)l[e[a]]&&(l[e[a]].state.loaded||l[e[a]].state.failed)&&!s||(c.push(e[a]),(o=this.get_node(e[a],!0))&&o.length&&o.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},c.length){if($.vakata.is_function(d))return d.call(this,c,function(a){var n,d;if(a)for(n in a)a.hasOwnProperty(n)&&(this._data.massload[n]=a[n]);for(n=0,d=e.length;n<d;n++)(o=this.get_node(e[n],!0))&&o.length&&o.removeClass("jstree-loading").attr("aria-busy",!1);t._load_nodes.call(this,e,i,r,s)}.bind(this));if("object"==typeof d&&d&&d.url)return d=$.extend(!0,{},d),$.vakata.is_function(d.url)&&(d.url=d.url.call(this,c)),$.vakata.is_function(d.data)&&(d.data=d.data.call(this,c)),$.ajax(d).done(function(a,n,d){var c,l;if(a)for(c in a)a.hasOwnProperty(c)&&(this._data.massload[c]=a[c]);for(c=0,l=e.length;c<l;c++)(o=this.get_node(e[c],!0))&&o.length&&o.removeClass("jstree-loading").attr("aria-busy",!1);t._load_nodes.call(this,e,i,r,s)}.bind(this)).fail(function(a){t._load_nodes.call(this,e,i,r,s)}.bind(this))}}return t._load_nodes.call(this,e,i,r,s)},this._load_node=function(e,i){var r,s=this._data.massload[e.id],a=null;return s?(a=this["string"==typeof s?"_append_html_data":"_append_json_data"](e,"string"==typeof s?$($.parseHTML(s)).filter((function(){return 3!==this.nodeType})):s,(function(e){i.call(this,e)})),(r=this.get_node(e.id,!0))&&r.length&&r.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[e.id],a):t._load_node.call(this,e,i)}},$.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},$.jstree.plugins.search=function(t,i){this.bind=function(){i.bind.call(this),this._data.search.str="",this._data.search.dom=$(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",function(e,t){if(this._data.search.som&&t.res.length){var i,r,s,a,n=this._model.data,o=[];for(i=0,r=t.res.length;i<r;i++)if(n[t.res[i]]&&!n[t.res[i]].state.hidden&&(o.push(t.res[i]),o=o.concat(n[t.res[i]].parents),this._data.search.smc))for(s=0,a=n[t.res[i]].children_d.length;s<a;s++)n[n[t.res[i]].children_d[s]]&&!n[n[t.res[i]].children_d[s]].state.hidden&&o.push(n[t.res[i]].children_d[s]);o=$.vakata.array_remove_item($.vakata.array_unique(o),$.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(o,!0),this.redraw(!0)}}.bind(this)).on("clear_search.jstree",function(e,t){this._data.search.som&&t.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))}.bind(this))},this.search=function(t,i,r,s,a,n){if(!1===t||""===$.vakata.trim(t.toString()))return this.clear_search();s=(s=this.get_node(s))&&(s.id||0===s.id)?s.id:null,t=t.toString();var o,d,c=this.settings.search,l=!!c.ajax&&c.ajax,h=this._model.data,_=null,u=[],g=[];if(this._data.search.res.length&&!a&&this.clear_search(),r===e&&(r=c.show_only_matches),n===e&&(n=c.show_only_matches_children),!i&&!1!==l)return $.vakata.is_function(l)?l.call(this,t,function(e){e&&e.d&&(e=e.d),this._load_nodes($.vakata.is_array(e)?$.vakata.array_unique(e):[],(function(){this.search(t,!0,r,s,a,n)}))}.bind(this),s):((l=$.extend({},l)).data||(l.data={}),l.data.str=t,s&&(l.data.inside=s),this._data.search.lastRequest&&this._data.search.lastRequest.abort(),this._data.search.lastRequest=$.ajax(l).fail(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(l)},this.settings.core.error.call(this,this._data.core.last_error)}.bind(this)).done(function(e){e&&e.d&&(e=e.d),this._load_nodes($.vakata.is_array(e)?$.vakata.array_unique(e):[],(function(){this.search(t,!0,r,s,a,n)}))}.bind(this)),this._data.search.lastRequest);if(a||(this._data.search.str=t,this._data.search.dom=$(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=r,this._data.search.smc=n),_=new $.vakata.search(t,!0,{caseSensitive:c.case_sensitive,fuzzy:c.fuzzy}),$.each(h[s||$.jstree.root].children_d,(function(e,i){var r=h[i];r.text&&!r.state.hidden&&(!c.search_leaves_only||r.state.loaded&&0===r.children.length)&&(c.search_callback&&c.search_callback.call(this,t,r)||!c.search_callback&&_.search(r.text).isMatch)&&(u.push(i),g=g.concat(r.parents))})),u.length){for(o=0,d=(g=$.vakata.array_unique(g)).length;o<d;o++)g[o]!==$.jstree.root&&h[g[o]]&&!0===this.open_node(g[o],null,0)&&this._data.search.opn.push(g[o]);a?(this._data.search.dom=this._data.search.dom.add($(this.element[0].querySelectorAll("#"+$.map(u,(function(e){return-1!=="0123456789".indexOf(e[0])?"\\3"+e[0]+" "+e.substr(1).replace($.jstree.idregex,"\\$&"):e.replace($.jstree.idregex,"\\$&")})).join(", #")))),this._data.search.res=$.vakata.array_unique(this._data.search.res.concat(u))):(this._data.search.dom=$(this.element[0].querySelectorAll("#"+$.map(u,(function(e){return-1!=="0123456789".indexOf(e[0])?"\\3"+e[0]+" "+e.substr(1).replace($.jstree.idregex,"\\$&"):e.replace($.jstree.idregex,"\\$&")})).join(", #"))),this._data.search.res=u),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:t,res:this._data.search.res,show_only_matches:r})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=$(this.element[0].querySelectorAll("#"+$.map(this._data.search.res,(function(e){return-1!=="0123456789".indexOf(e[0])?"\\3"+e[0]+" "+e.substr(1).replace($.jstree.idregex,"\\$&"):e.replace($.jstree.idregex,"\\$&")})).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=$()},this.redraw_node=function(e,t,r,s){if((e=i.redraw_node.apply(this,arguments))&&-1!==$.inArray(e.id,this._data.search.res)){var a,n,o=null;for(a=0,n=e.childNodes.length;a<n;a++)if(e.childNodes[a]&&e.childNodes[a].className&&-1!==e.childNodes[a].className.indexOf("jstree-anchor")){o=e.childNodes[a];break}o&&(o.className+=" jstree-search")}return e}},function($){$.vakata.search=function(e,t,i){i=i||{},!1!==(i=$.extend({},$.vakata.search.defaults,i)).fuzzy&&(i.fuzzy=!0),e=i.caseSensitive?e:e.toLowerCase();var r,s,a,n,o=i.location,d=i.distance,c=i.threshold,l=e.length;return l>32&&(i.fuzzy=!1),i.fuzzy&&(r=1<<l-1,s=function(){var t={},i=0;for(i=0;i<l;i++)t[e.charAt(i)]=0;for(i=0;i<l;i++)t[e.charAt(i)]|=1<<l-i-1;return t}(),a=function(e,t){var i=e/l,r=Math.abs(o-t);return d?i+r/d:r?1:i}),n=function(t){if(t=i.caseSensitive?t.toString():t.toString().toLowerCase(),e===t||-1!==t.indexOf(e))return{isMatch:!0,score:0};if(!i.fuzzy)return{isMatch:!1,score:1};var n,d,h,_,u,g,f,p,m,v=t.length,j=c,k=t.indexOf(e,o),b=l+v,y=1,x=[];for(-1!==k&&(j=Math.min(a(0,k),j),-1!==(k=t.lastIndexOf(e,o+l))&&(j=Math.min(a(0,k),j))),k=-1,n=0;n<l;n++){for(h=0,_=b;h<_;)a(n,o+_)<=j?h=_:b=_,_=Math.floor((b-h)/2+h);for(b=_,g=Math.max(1,o-_+1),f=Math.min(o+_,v)+l,(p=new Array(f+2))[f+1]=(1<<n)-1,d=f;d>=g;d--)if(m=s[t.charAt(d-1)],p[d]=0===n?(p[d+1]<<1|1)&m:(p[d+1]<<1|1)&m|(u[d+1]|u[d])<<1|1|u[d+1],p[d]&r&&(y=a(n,d-1))<=j){if(j=y,k=d-1,x.push(k),!(k>o))break;g=Math.max(1,2*o-k)}if(a(n+1,o)>j)break;u=p}return{isMatch:k>=0,score:y}},!0===t?{search:n}:n(t)},$.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}($),$.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},$.jstree.plugins.sort=function(e,t){this.bind=function(){t.bind.call(this),this.element.on("model.jstree",function(e,t){this.sort(t.parent,!0)}.bind(this)).on("rename_node.jstree create_node.jstree",function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)}.bind(this)).on("move_node.jstree copy_node.jstree",function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)}.bind(this))},this.sort=function(e,t){var i,r;if((e=this.get_node(e))&&e.children&&e.children.length&&(e.children.sort(this.settings.sort.bind(this)),t))for(i=0,r=e.children_d.length;i<r;i++)this.sort(e.children_d[i],!1)}};var u=!1;$.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1,preserve_loaded:!1},$.jstree.plugins.state=function(e,t){this.bind=function(){t.bind.call(this);var e=function(){this.element.on(this.settings.state.events,function(){u&&clearTimeout(u),u=setTimeout(function(){this.save_state()}.bind(this),100)}.bind(this)),this.trigger("state_ready")}.bind(this);this.element.on("ready.jstree",function(t,i){this.element.one("restore_state.jstree",e),this.restore_state()||e()}.bind(this))},this.save_state=function(){var e=this.get_state()
;this.settings.state.preserve_loaded||delete e.core.loaded;var t={state:e,ttl:this.settings.state.ttl,sec:+new Date};$.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var e=$.vakata.storage.get(this.settings.state.key);if(e)try{e=JSON.parse(e)}catch(e){return!1}return!(e&&e.ttl&&e.sec&&+new Date-e.sec>e.ttl)&&(e&&e.state&&(e=e.state),e&&$.vakata.is_function(this.settings.state.filter)&&(e=this.settings.state.filter.call(this,e)),!!e&&(this.settings.state.preserve_loaded||delete e.core.loaded,this.element.one("set_state.jstree",(function(t,i){i.instance.trigger("restore_state",{state:$.extend(!0,{},e)})})),this.set_state(e),!0))},this.clear_state=function(){return $.vakata.storage.del(this.settings.state.key)}},function($,e){$.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}($),$.jstree.defaults.types={default:{}},$.jstree.defaults.types[$.jstree.root]={},$.jstree.plugins.types=function(t,i){this.init=function(t,r){var s,a;if(r&&r.types&&r.types.default)for(s in r.types)if("default"!==s&&s!==$.jstree.root&&r.types.hasOwnProperty(s))for(a in r.types.default)r.types.default.hasOwnProperty(a)&&r.types[s][a]===e&&(r.types[s][a]=r.types.default[a]);i.init.call(this,t,r),this._model.data[$.jstree.root].type=$.jstree.root},this.refresh=function(e,t){i.refresh.call(this,e,t),this._model.data[$.jstree.root].type=$.jstree.root},this.bind=function(){this.element.on("model.jstree",function(t,i){var r,s,a,n=this._model.data,o=i.nodes,d=this.settings.types,c="default";for(r=0,s=o.length;r<s;r++){if(c="default",n[o[r]].original&&n[o[r]].original.type&&d[n[o[r]].original.type]&&(c=n[o[r]].original.type),n[o[r]].data&&n[o[r]].data.jstree&&n[o[r]].data.jstree.type&&d[n[o[r]].data.jstree.type]&&(c=n[o[r]].data.jstree.type),n[o[r]].type=c,!0===n[o[r]].icon&&d[c].icon!==e&&(n[o[r]].icon=d[c].icon),d[c].li_attr!==e&&"object"==typeof d[c].li_attr)for(a in d[c].li_attr)if(d[c].li_attr.hasOwnProperty(a)){if("id"===a)continue;n[o[r]].li_attr[a]===e?n[o[r]].li_attr[a]=d[c].li_attr[a]:"class"===a&&(n[o[r]].li_attr.class=d[c].li_attr.class+" "+n[o[r]].li_attr.class)}if(d[c].a_attr!==e&&"object"==typeof d[c].a_attr)for(a in d[c].a_attr)if(d[c].a_attr.hasOwnProperty(a)){if("id"===a)continue;n[o[r]].a_attr[a]===e?n[o[r]].a_attr[a]=d[c].a_attr[a]:"href"===a&&"#"===n[o[r]].a_attr[a]?n[o[r]].a_attr.href=d[c].a_attr.href:"class"===a&&(n[o[r]].a_attr.class=d[c].a_attr.class+" "+n[o[r]].a_attr.class)}}n[$.jstree.root].type=$.jstree.root}.bind(this)),i.bind.call(this)},this.get_json=function(e,t,r){var s,a,n=this._model.data,o=t?$.extend(!0,{},t,{no_id:!1}):{},d=i.get_json.call(this,e,o,r);if(!1===d)return!1;if($.vakata.is_array(d))for(s=0,a=d.length;s<a;s++)d[s].type=(d[s].id||0===d[s].id)&&n[d[s].id]&&n[d[s].id].type?n[d[s].id].type:"default",t&&t.no_id&&(delete d[s].id,d[s].li_attr&&d[s].li_attr.id&&delete d[s].li_attr.id,d[s].a_attr&&d[s].a_attr.id&&delete d[s].a_attr.id);else d.type=(d.id||0===d.id)&&n[d.id]&&n[d.id].type?n[d.id].type:"default",t&&t.no_id&&(d=this._delete_ids(d));return d},this._delete_ids=function(e){if($.vakata.is_array(e)){for(var t=0,i=e.length;t<i;t++)e[t]=this._delete_ids(e[t]);return e}return delete e.id,e.li_attr&&e.li_attr.id&&delete e.li_attr.id,e.a_attr&&e.a_attr.id&&delete e.a_attr.id,e.children&&$.vakata.is_array(e.children)&&(e.children=this._delete_ids(e.children)),e},this.check=function(t,r,s,a,n){if(!1===i.check.call(this,t,r,s,a,n))return!1;r=r&&(r.id||0===r.id)?r:this.get_node(r),s=s&&(s.id||0===s.id)?s:this.get_node(s);var o,d,c,l,h=r&&(r.id||0===r.id)?n&&n.origin?n.origin:$.jstree.reference(r.id):null;switch(h=h&&h._model&&h._model.data?h._model.data:null,t){case"create_node":case"move_node":case"copy_node":if("move_node"!==t||-1===$.inArray(r.id,s.children)){if((o=this.get_rules(s)).max_children!==e&&-1!==o.max_children&&o.max_children===s.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+t,data:JSON.stringify({chk:t,pos:a,obj:!(!r||!r.id&&0!==r.id)&&r.id,par:!(!s||!s.id&&0!==s.id)&&s.id})},!1;if(o.valid_children!==e&&-1!==o.valid_children&&-1===$.inArray(r.type||"default",o.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+t,data:JSON.stringify({chk:t,pos:a,obj:!(!r||!r.id&&0!==r.id)&&r.id,par:!(!s||!s.id&&0!==s.id)&&s.id})},!1;if(h&&r.children_d&&r.parents){for(d=0,c=0,l=r.children_d.length;c<l;c++)d=Math.max(d,h[r.children_d[c]].parents.length);d=d-r.parents.length+1}(d<=0||d===e)&&(d=1);do{if(o.max_depth!==e&&-1!==o.max_depth&&o.max_depth<d)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+t,data:JSON.stringify({chk:t,pos:a,obj:!(!r||!r.id&&0!==r.id)&&r.id,par:!(!s||!s.id&&0!==s.id)&&s.id})},!1;s=this.get_node(s.parent),o=this.get_rules(s),d++}while(s)}}return!0},this.get_rules=function(t){if(!(t=this.get_node(t)))return!1;var i=this.get_type(t,!0);return i.max_depth===e&&(i.max_depth=-1),i.max_children===e&&(i.max_children=-1),i.valid_children===e&&(i.valid_children=-1),i},this.get_type=function(e,t){return!!(e=this.get_node(e))&&(t?$.extend({type:e.type},this.settings.types[e.type]):e.type)},this.set_type=function(t,i){var r,s,a,n,o,d,c,l,h=this._model.data;if($.vakata.is_array(t)){for(s=0,a=(t=t.slice()).length;s<a;s++)this.set_type(t[s],i);return!0}if(r=this.settings.types,t=this.get_node(t),!r[i]||!t)return!1;if((c=this.get_node(t,!0))&&c.length&&(l=c.children(".jstree-anchor")),n=t.type,o=this.get_icon(t),t.type=i,(!0===o||!r[n]||r[n].icon!==e&&o===r[n].icon)&&this.set_icon(t,r[i].icon===e||r[i].icon),r[n]&&r[n].li_attr!==e&&"object"==typeof r[n].li_attr)for(d in r[n].li_attr)if(r[n].li_attr.hasOwnProperty(d)){if("id"===d)continue;"class"===d?(h[t.id].li_attr.class=(h[t.id].li_attr.class||"").replace(r[n].li_attr[d],""),c&&c.removeClass(r[n].li_attr[d])):h[t.id].li_attr[d]===r[n].li_attr[d]&&(h[t.id].li_attr[d]=null,c&&c.removeAttr(d))}if(r[n]&&r[n].a_attr!==e&&"object"==typeof r[n].a_attr)for(d in r[n].a_attr)if(r[n].a_attr.hasOwnProperty(d)){if("id"===d)continue;"class"===d?(h[t.id].a_attr.class=(h[t.id].a_attr.class||"").replace(r[n].a_attr[d],""),l&&l.removeClass(r[n].a_attr[d])):h[t.id].a_attr[d]===r[n].a_attr[d]&&("href"===d?(h[t.id].a_attr[d]="#",l&&l.attr("href","#")):(delete h[t.id].a_attr[d],l&&l.removeAttr(d)))}if(r[i].li_attr!==e&&"object"==typeof r[i].li_attr)for(d in r[i].li_attr)if(r[i].li_attr.hasOwnProperty(d)){if("id"===d)continue;h[t.id].li_attr[d]===e?(h[t.id].li_attr[d]=r[i].li_attr[d],c&&("class"===d?c.addClass(r[i].li_attr[d]):c.attr(d,r[i].li_attr[d]))):"class"===d&&(h[t.id].li_attr.class=r[i].li_attr[d]+" "+h[t.id].li_attr.class,c&&c.addClass(r[i].li_attr[d]))}if(r[i].a_attr!==e&&"object"==typeof r[i].a_attr)for(d in r[i].a_attr)if(r[i].a_attr.hasOwnProperty(d)){if("id"===d)continue;h[t.id].a_attr[d]===e?(h[t.id].a_attr[d]=r[i].a_attr[d],l&&("class"===d?l.addClass(r[i].a_attr[d]):l.attr(d,r[i].a_attr[d]))):"href"===d&&"#"===h[t.id].a_attr[d]?(h[t.id].a_attr.href=r[i].a_attr.href,l&&l.attr("href",r[i].a_attr.href)):"class"===d&&(h[t.id].a_attr.class=r[i].a_attr.class+" "+h[t.id].a_attr.class,l&&l.addClass(r[i].a_attr[d]))}return!0}},$.jstree.defaults.unique={case_sensitive:!1,trim_whitespace:!1,duplicate:function(e,t){return e+" ("+t+")"}},$.jstree.plugins.unique=function(t,i){this.check=function(e,t,r,s,a){if(!1===i.check.call(this,e,t,r,s,a))return!1;if(t=t&&(t.id||0===t.id)?t:this.get_node(t),!(r=r&&(r.id||0===r.id)?r:this.get_node(r))||!r.children)return!0;var n,o,d,c="rename_node"===e?s:t.text,l=[],h=this.settings.unique.case_sensitive,_=this.settings.unique.trim_whitespace,u=this._model.data;for(n=0,o=r.children.length;n<o;n++)d=u[r.children[n]].text,h||(d=d.toLowerCase()),_&&(d=d.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),l.push(d);switch(h||(c=c.toLowerCase()),_&&(c=c.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),e){case"delete_node":return!0;case"rename_node":return d=t.text||"",h||(d=d.toLowerCase()),_&&(d=d.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),(n=-1===$.inArray(c,l)||t.text&&d===c)||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+c+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:s,obj:!(!t||!t.id&&0!==t.id)&&t.id,par:!(!r||!r.id&&0!==r.id)&&r.id})}),n;case"create_node":return(n=-1===$.inArray(c,l))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+c+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:s,obj:!(!t||!t.id&&0!==t.id)&&t.id,par:!(!r||!r.id&&0!==r.id)&&r.id})}),n;case"copy_node":return(n=-1===$.inArray(c,l))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+c+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:s,obj:!(!t||!t.id&&0!==t.id)&&t.id,par:!(!r||!r.id&&0!==r.id)&&r.id})}),n;case"move_node":return(n=t.parent===r.id&&(!a||!a.is_multi)||-1===$.inArray(c,l))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+c+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:s,obj:!(!t||!t.id&&0!==t.id)&&t.id,par:!(!r||!r.id&&0!==r.id)&&r.id})}),n}return!0},this.create_node=function(t,r,s,a,n){if(!r||"object"==typeof r&&r.text===e){if(null===t&&(t=$.jstree.root),!(t=this.get_node(t)))return i.create_node.call(this,t,r,s,a,n);if(!(s=s===e?"last":s).toString().match(/^(before|after)$/)&&!n&&!this.is_loaded(t))return i.create_node.call(this,t,r,s,a,n);r||(r={});var o,d,c,l,h,_,u=this._model.data,g=this.settings.unique.case_sensitive,f=this.settings.unique.trim_whitespace,p=this.settings.unique.duplicate;for(d=o=this.get_string("New node"),c=[],l=0,h=t.children.length;l<h;l++)_=u[t.children[l]].text,g||(_=_.toLowerCase()),f&&(_=_.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),c.push(_);for(l=1,_=d,g||(_=_.toLowerCase()),f&&(_=_.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));-1!==$.inArray(_,c);)_=d=p.call(this,o,++l).toString(),g||(_=_.toLowerCase()),f&&(_=_.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));r.text=d}return i.create_node.call(this,t,r,s,a,n)}};var g=o.createElement("DIV");if(g.setAttribute("unselectable","on"),g.setAttribute("role","presentation"),g.className="jstree-wholerow",g.innerHTML="&#160;",$.jstree.plugins.wholerow=function(e,t){this.bind=function(){t.bind.call(this),this.element.on("ready.jstree set_state.jstree",function(){this.hide_dots()}.bind(this)).on("init.jstree loading.jstree ready.jstree",function(){this.get_container_ul().addClass("jstree-wholerow-ul")}.bind(this)).on("deselect_all.jstree",function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")}.bind(this)).on("changed.jstree",function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var i,r,s=!1;for(i=0,r=t.selected.length;i<r;i++)(s=this.get_node(t.selected[i],!0))&&s.length&&s.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}.bind(this)).on("open_node.jstree",function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}.bind(this)).on("hover_node.jstree dehover_node.jstree",function(e,t){"hover_node"===e.type&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")}.bind(this)).on("contextmenu.jstree",".jstree-wholerow",function(e){if(this._data.contextmenu){e.preventDefault();var t=$.Event("contextmenu",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,pageX:e.pageX,pageY:e.pageY});$(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(t)}}.bind(this))
/*!
				.on("mousedown.jstree touchstart.jstree", ".jstree-wholerow", function (e) {
						if(e.target === e.currentTarget) {
							var a = $(e.currentTarget).closest(".jstree-node").children(".jstree-anchor");
							e.target = a[0];
							a.trigger(e);
						}
					})
				*/.on("click.jstree",".jstree-wholerow",(function(e){e.stopImmediatePropagation();var t=$.Event("click",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey});$(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(t).trigger("focus")})).on("dblclick.jstree",".jstree-wholerow",(function(e){e.stopImmediatePropagation();var t=$.Event("dblclick",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey});$(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(t).trigger("focus")})).on("click.jstree",".jstree-leaf > .jstree-ocl",function(e){e.stopImmediatePropagation();var t=$.Event("click",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey});$(e.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(t).trigger("focus")}.bind(this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1}.bind(this)).on("mouseleave.jstree",".jstree-node",function(e){this.dehover_node(e.currentTarget)}.bind(this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),t.teardown.call(this)},this.redraw_node=function(e,i,r,s){if(e=t.redraw_node.apply(this,arguments)){var a=g.cloneNode(!0);-1!==$.inArray(e.id,this._data.core.selected)&&(a.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===e.id&&(a.className+=" jstree-wholerow-hovered"),e.insertBefore(a,e.childNodes[0])}return e}},window.customElements&&Object&&Object.create){var f=Object.create(HTMLElement.prototype);f.createdCallback=function(){var e,t={core:{},plugins:[]};for(e in $.jstree.plugins)$.jstree.plugins.hasOwnProperty(e)&&this.attributes[e]&&(t.plugins.push(e),this.getAttribute(e)&&JSON.parse(this.getAttribute(e))&&(t[e]=JSON.parse(this.getAttribute(e))));for(e in $.jstree.defaults.core)$.jstree.defaults.core.hasOwnProperty(e)&&this.attributes[e]&&(t.core[e]=JSON.parse(this.getAttribute(e))||this.getAttribute(e));$(this).jstree(t)};try{window.customElements.define("vakata-jstree",(function(){}),{prototype:f})}catch(e){}}}}));